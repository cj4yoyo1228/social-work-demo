<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å€‹æ¡ˆæœå‹™ç´€éŒ„ â€” æ°¸é½¡å¸Œæœ›å°å­¸</title>
    <!-- Google Fontsï¼šNoto Sans TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* ===== å…¨åŸŸåŸºç¤ ===== */
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: #f0faf9;
        color: #1f2937;
        margin: 0;
        padding: 0;
      }

      /* ===== é é¢å®¹å™¨ ===== */
      .page-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 24px 16px;
        min-height: 100vh;
      }

      /* ===== ç•«é¢åˆ‡æ›å‹•ç•« ===== */
      /* æ¯å€‹ç‹€æ…‹éƒ½æ˜¯ç¨ç«‹çš„ viewï¼Œé€é JS æ§åˆ¶ active */
      .view {
        display: none;
        opacity: 0;
        transition: opacity 0.35s ease;
      }

      .view.active {
        display: block;
        opacity: 1;
      }

      /* é€²å ´å‹•ç•«ï¼ˆç”¨ JS è§¸ç™¼ï¼‰ */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .slide-in {
        animation: slideInUp 0.35s ease forwards;
      }

      /* å¡ç‰‡äº¤éŒ¯é€²å ´ï¼ˆstaggered animationï¼‰ */
      @keyframes staggerIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ===== é ‚éƒ¨å°è¦½åˆ— ===== */
      .page-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .page-title {
        font-size: 20px;
        font-weight: 700;
        color: #1f2937;
        flex: 1;
      }

      /* è¿”å›æŒ‰éˆ• */
      .nav-back {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        color: #00897b;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        padding: 8px 0;
        text-decoration: none;
        flex-shrink: 0;
        transition: color 0.2s ease;
      }

      .nav-back:hover {
        color: #00695c;
      }

      /* ===== æœå°‹æ¡† ===== */
      .search-wrapper {
        margin-bottom: 16px;
      }

      .search-input {
        width: 100%;
        padding: 11px 16px 11px 42px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 15px;
        outline: none;
        transition: border-color 0.2s ease;
        font-family: "Noto Sans TC", sans-serif;
        background-color: #ffffff;
        /* æœå°‹åœ–ç¤ºï¼ˆSVG inlineï¼‰ */
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239CA3AF'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: 12px center;
        background-size: 20px;
        color: #1f2937;
      }

      .search-input::placeholder {
        color: #9ca3af;
      }

      .search-input:focus {
        border-color: #00897b;
        box-shadow: 0 0 0 3px rgba(0, 137, 123, 0.1);
      }

      /* ===== å¡ç‰‡åŸºç¤æ¨£å¼ ===== */
      .card {
        background: #ffffff;
        border-radius: 12px;
        box-shadow:
          0 1px 3px rgba(0, 0, 0, 0.06),
          0 4px 12px rgba(0, 137, 123, 0.04);
        padding: 16px;
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease;
      }

      /* å¯é»æ“Šçš„å¡ç‰‡ */
      .card-clickable {
        cursor: pointer;
      }

      .card-clickable:hover {
        transform: translateY(-2px);
        box-shadow:
          0 6px 20px rgba(0, 137, 123, 0.12),
          0 2px 6px rgba(0, 0, 0, 0.08);
      }

      .card-clickable:active {
        transform: translateY(0);
      }

      /* ===== å­¸ç”Ÿåˆ—è¡¨å¡ç‰‡ ===== */
      .student-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .student-card-name {
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 3px;
      }

      .student-card-class {
        font-size: 13px;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .student-card-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 6px;
      }

      .tags-group {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        align-items: center;
      }

      .last-record-date {
        font-size: 12px;
        color: #9ca3af;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .last-record-date.has-record {
        color: #6b7280;
      }

      /* ===== é¢¨éšªç­‰ç´šæ¨™ç±¤ ===== */
      /* ç©©å®šï¼ˆç¶ ï¼‰ */
      .risk-tag {
        display: inline-flex;
        align-items: center;
        gap: 3px;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
      }

      .risk-stable {
        background: #d1fae5;
        color: #065f46;
      }

      /* éœ€é—œæ³¨ï¼ˆé»ƒï¼‰ */
      .risk-watch {
        background: #fef3c7;
        color: #92400e;
      }

      /* é«˜é¢¨éšªï¼ˆç´…ï¼‰ */
      .risk-high {
        background: #fee2e2;
        color: #991b1b;
      }

      /* ä¸€èˆ¬å°æ¨™ç±¤ï¼ˆé’ç¶ ï¼Œè§€å¯Ÿç´€éŒ„ç”¨ï¼‰ */
      .tag-small {
        display: inline-block;
        padding: 3px 9px;
        border-radius: 10px;
        font-size: 12px;
        background: #e0f2f1;
        color: #00695c;
        font-weight: 500;
      }

      /* ===== å­¸ç”Ÿå€‹åˆ¥é é¢ â€” åŸºæœ¬è³‡è¨Š ===== */
      .info-row {
        display: flex;
        align-items: flex-start;
        padding: 10px 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .info-row:last-child {
        border-bottom: none;
        padding-bottom: 0;
      }

      .info-row:first-child {
        padding-top: 0;
      }

      .info-label {
        width: 76px;
        font-size: 13px;
        color: #9ca3af;
        flex-shrink: 0;
        padding-top: 2px;
      }

      .info-value {
        font-size: 14px;
        color: #1f2937;
        font-weight: 500;
        flex: 1;
        line-height: 1.5;
      }

      /* å‚™è¨»æ¬„ä½ï¼ˆç°è‰²å¼•ç”¨æ„Ÿï¼‰ */
      .info-note {
        font-size: 13px;
        color: #6b7280;
        background: #f9fafb;
        border-left: 3px solid #d1d5db;
        padding: 6px 10px;
        border-radius: 4px;
        flex: 1;
        line-height: 1.6;
      }

      /* ===== Section æ¨™é¡Œ ===== */
      .section-title {
        font-size: 15px;
        font-weight: 700;
        color: #374151;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      /* ===== ç´€éŒ„æ™‚é–“è»¸ ===== */
      /* å·¦å´è±ç·šä¸²é€£çš„æ™‚é–“è»¸è¨­è¨ˆ */
      .record-timeline {
        position: relative;
        padding-left: 24px;
      }

      /* å·¦å´è±ç·š */
      .record-timeline::before {
        content: "";
        position: absolute;
        left: 7px;
        top: 6px;
        bottom: 6px;
        width: 2px;
        background: linear-gradient(to bottom, #80cbc4, #e5e7eb);
        border-radius: 1px;
      }

      .record-item {
        position: relative;
        padding: 0 0 20px 16px;
      }

      .record-item:last-child {
        padding-bottom: 0;
      }

      /* æ™‚é–“ç¯€é»åœ“é» */
      .record-item::before {
        content: "";
        position: absolute;
        left: -19px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #00897b;
        border: 2.5px solid #ffffff;
        box-shadow: 0 0 0 2px #80cbc4;
        z-index: 1;
      }

      /* æœ€æ–°ä¸€ç­†ç´€éŒ„çš„ç¯€é»ç”¨ç«ç‘°ç²‰é«˜äº® */
      .record-item.latest::before {
        background: #ec4899;
        box-shadow: 0 0 0 2px #fce7f3;
      }

      .record-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 5px;
      }

      .record-date-label {
        font-size: 12px;
        color: #9ca3af;
        font-weight: 500;
      }

      .record-note-text {
        font-size: 14px;
        color: #374151;
        line-height: 1.65;
      }

      /* æ–°å¢å¾Œçš„é«˜äº®å‹•ç•« */
      @keyframes newRecordHighlight {
        0% {
          background-color: #fce7f3;
        }
        100% {
          background-color: transparent;
        }
      }

      .record-item.new-highlight {
        border-radius: 8px;
        animation: newRecordHighlight 2s ease forwards;
      }

      /* ===== åº•éƒ¨å›ºå®šæŒ‰éˆ• ===== */
      .content-with-bottom-btn {
        padding-bottom: 88px;
      }

      .bottom-fixed-area {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 14px 16px 20px;
        background: linear-gradient(to top, #f0faf9 75%, transparent);
        pointer-events: none;
      }

      .bottom-fixed-inner {
        max-width: 800px;
        margin: 0 auto;
        pointer-events: all;
      }

      /* ===== æŒ‰éˆ•æ¨£å¼ ===== */
      /* ä¸»æŒ‰éˆ•ï¼ˆé’ç¶ ï¼‰ */
      .btn-primary {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        width: 100%;
        padding: 14px 24px;
        background: linear-gradient(135deg, #00897b 0%, #26a69a 100%);
        color: #ffffff;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: "Noto Sans TC", sans-serif;
        box-shadow: 0 2px 8px rgba(0, 137, 123, 0.2);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(0, 137, 123, 0.45);
      }

      .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(0, 137, 123, 0.3);
      }

      /* Phase 2 é ç•™æŒ‰éˆ•ï¼ˆç°è‰²ä¸å¯é»æ“Šï¼‰ */
      .btn-phase2 {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 9px 16px;
        background: #f3f4f6;
        color: #9ca3af;
        border: 1.5px dashed #d1d5db;
        border-radius: 10px;
        font-size: 14px;
        cursor: not-allowed;
        position: relative;
        font-family: "Noto Sans TC", sans-serif;
        transition: all 0.2s ease;
        user-select: none;
      }

      /* Tooltipã€Œå³å°‡æ¨å‡ºã€ï¼Œhover é¡¯ç¤º */
      .btn-phase2::after {
        content: "ğŸ”œ å³å°‡æ¨å‡º";
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%);
        background: #1f2937;
        color: white;
        padding: 5px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 100;
        font-family: "Noto Sans TC", sans-serif;
      }

      /* Tooltip å°ç®­é ­ */
      .btn-phase2::before {
        content: "";
        position: absolute;
        bottom: calc(100% + 2px);
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #1f2937;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 100;
      }

      .btn-phase2:hover::after,
      .btn-phase2:hover::before {
        opacity: 1;
      }

      /* ===== è¡¨å–®æ¨£å¼ï¼ˆç‹€æ…‹ 3ï¼šæ–°å¢ç´€éŒ„ï¼‰ ===== */
      .form-section {
        margin-bottom: 12px;
      }

      .form-label {
        display: block;
        font-size: 14px;
        font-weight: 700;
        color: #374151;
        margin-bottom: 10px;
      }

      /* è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå¯å¤šé¸ï¼‰ */
      .tag-chips-area {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      /* æœªé¸ä¸­ç‹€æ…‹ */
      .tag-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 7px 14px;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        border: 2px solid #e5e7eb;
        background: #ffffff;
        color: #6b7280;
        transition: all 0.18s ease;
        user-select: none;
        font-family: "Noto Sans TC", sans-serif;
      }

      .tag-chip:hover {
        border-color: #80cbc4;
        color: #00897b;
        background: #e0f2f1;
      }

      /* é¸ä¸­ç‹€æ…‹ï¼ˆé’ç¶ è‰²å¡«å……ï¼‰ */
      .tag-chip.selected {
        background: linear-gradient(135deg, #00897b, #26a69a);
        border-color: #00897b;
        color: #ffffff;
        box-shadow: 0 2px 8px rgba(0, 137, 123, 0.25);
        transform: scale(1.03);
      }

      /* æ–‡å­—è¼¸å…¥æ¡†ï¼ˆå¤§ã€å¥½è¼¸å…¥ï¼‰ */
      .record-textarea {
        width: 100%;
        padding: 14px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 15px;
        font-family: "Noto Sans TC", sans-serif;
        line-height: 1.7;
        outline: none;
        resize: vertical;
        min-height: 120px;
        transition: border-color 0.2s ease;
        color: #1f2937;
        background: #fefefe;
      }

      .record-textarea::placeholder {
        color: #9ca3af;
      }

      .record-textarea:focus {
        border-color: #00897b;
        box-shadow: 0 0 0 3px rgba(0, 137, 123, 0.1);
      }

      /* Phase 2 æŒ‰éˆ•ç¾¤çµ„ */
      .phase2-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      /* ===== æˆåŠŸå‹•ç•«è¦†è“‹å±¤ ===== */
      #success-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.92);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      #success-overlay.show {
        opacity: 1;
        pointer-events: all;
      }

      @keyframes checkPop {
        0% {
          transform: scale(0) rotate(-10deg);
          opacity: 0;
        }
        60% {
          transform: scale(1.2) rotate(3deg);
          opacity: 1;
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      .success-icon {
        font-size: 72px;
        animation: checkPop 0.5s ease forwards;
      }

      .success-text {
        margin-top: 16px;
        font-size: 20px;
        font-weight: 700;
        color: #065f46;
        animation: checkPop 0.5s ease 0.1s both;
      }

      /* ===== ç©ºç‹€æ…‹æç¤º ===== */
      .empty-hint {
        text-align: center;
        color: #9ca3af;
        font-size: 14px;
        padding: 28px 0;
      }

      /* ===== Toast æç¤º ===== */
      .toast {
        position: fixed;
        bottom: 28px;
        left: 50%;
        transform: translateX(-50%);
        background: #1f2937;
        color: white;
        padding: 11px 22px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        white-space: nowrap;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.2);
        font-family: "Noto Sans TC", sans-serif;
      }

      .toast.show {
        opacity: 1;
      }

      /* ===== æ²è»¸ç¾åŒ– ===== */
      ::-webkit-scrollbar {
        width: 5px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }

      /* ===== éŸ¿æ‡‰å¼èª¿æ•´ ===== */
      @media (max-width: 480px) {
        .page-container {
          padding: 16px 12px;
        }

        .page-title {
          font-size: 18px;
        }

        .tag-chip {
          font-size: 13px;
          padding: 6px 12px;
        }
      }

      /* ===== AI å³æ™‚åæ€å¼•å°ç³»çµ±æ¨£å¼ ===== */

      /* æ–‡å­—æ¡†ä¸Šæ–¹çš„å°æç¤ºæ–‡å­— */
      .ai-hint-text {
        font-size: 12px;
        color: #9ca3af;
        margin-bottom: 8px;
        display: block;
        font-weight: 400;
      }

      /* AI åˆ†æä¸­çš„ç­‰å¾…æç¤ºï¼ˆå¸¶å½ˆè·³åœ“é»å‹•ç•«ï¼‰ */
      .ai-analyzing {
        display: none;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: #6b7280;
        margin-top: 8px;
        padding: 6px 10px;
        background: #f9fafb;
        border-radius: 8px;
        width: fit-content;
      }

      .ai-analyzing.visible {
        display: flex;
      }

      /* å½ˆè·³åœ“é»å‹•ç•« */
      .dot-bounce {
        display: flex;
        gap: 3px;
        align-items: center;
      }

      .dot-bounce span {
        width: 5px;
        height: 5px;
        background: #00897b;
        border-radius: 50%;
        display: inline-block;
        animation: dotBounce 1.2s infinite ease-in-out;
      }

      .dot-bounce span:nth-child(1) {
        animation-delay: 0s;
      }
      .dot-bounce span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .dot-bounce span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes dotBounce {
        0%,
        80%,
        100% {
          transform: scale(0.6);
          opacity: 0.4;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* AI å¼•å°å¡ç‰‡å®¹å™¨ï¼ˆå¡ç‰‡æ’å…¥æ­¤è™•ï¼‰ */
      .ai-guidance-container {
        margin-top: 10px;
        overflow: hidden;
      }

      /* AI å¼•å°å¡ç‰‡åŸºç¤æ¨£å¼ */
      .ai-guidance-card {
        border-radius: 12px;
        padding: 14px 16px;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        animation: aiCardSlideIn 0.35s ease forwards;
      }

      /* å¡ç‰‡é€²å ´å‹•ç•«ï¼ˆslideUp + fadeInï¼‰ */
      @keyframes aiCardSlideIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* å¡ç‰‡é€€å ´å‹•ç•« */
      @keyframes aiCardSlideOut {
        from {
          opacity: 1;
          transform: translateY(0);
        }
        to {
          opacity: 0;
          transform: translateY(10px);
        }
      }

      .ai-guidance-card.hiding {
        animation: aiCardSlideOut 0.25s ease forwards;
      }

      /* æƒ…å¢ƒä¸€ï¼šæƒ…ç·’æ³¢å‹•ï¼ˆç´…è‰²ï¼‰ */
      .ai-card-emotion {
        border-left: 4px solid #ef4444;
        background: #fef2f2;
      }

      /* æƒ…å¢ƒäºŒï¼šé«˜é¢¨éšªé è­¦ï¼ˆæ©˜è‰² + åŠ å¼·è¦–è¦ºï¼‰ */
      .ai-card-risk {
        border-left: 4px solid #f97316;
        background: #fff7ed;
        border: 2px solid #f97316;
        border-left: 6px solid #f97316;
      }

      /* æƒ…å¢ƒäºŒï¼šæ©˜è‰²è„ˆå‹•é‚Šæ¡†æ•ˆæœ */
      @keyframes riskPulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.3);
        }
        50% {
          box-shadow: 0 0 0 6px rgba(249, 115, 22, 0);
        }
      }

      .ai-card-risk {
        animation:
          aiCardSlideIn 0.35s ease forwards,
          riskPulse 2s ease-in-out 0.4s infinite;
      }

      .ai-card-risk.hiding {
        animation: aiCardSlideOut 0.25s ease forwards;
      }

      /* æƒ…å¢ƒä¸‰ï¼šæ­£å‘è¡Œç‚ºï¼ˆç¶ è‰²ï¼‰ */
      .ai-card-positive {
        border-left: 4px solid #10b981;
        background: #ecfdf5;
      }

      /* å³ä¸Šè§’ã€ŒğŸ¤– AI å¼•å°ã€æ¨™ç¤º */
      .ai-card-badge {
        position: absolute;
        top: 10px;
        right: 12px;
        font-size: 11px;
        color: #9ca3af;
        font-weight: 500;
        white-space: nowrap;
      }

      /* å¡ç‰‡å…§çš„é—œé–‰æŒ‰éˆ•ï¼ˆXï¼‰ */
      .ai-card-close {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 22px;
        height: 22px;
        background: rgba(0, 0, 0, 0.08);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 12px;
        color: #6b7280;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        padding: 0;
        transition: background 0.2s ease;
        font-family: "Noto Sans TC", sans-serif;
      }

      .ai-card-close:hover {
        background: rgba(0, 0, 0, 0.15);
        color: #374151;
      }

      /* å¡ç‰‡æ¨™ç±¤ï¼ˆğŸ”´ åµæ¸¬åˆ°æƒ…ç·’æ³¢å‹• ç­‰ï¼‰ */
      .ai-card-label {
        font-size: 13px;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 8px;
        padding-right: 60px; /* é¿å…è¢«å³ä¸Šè§’ badge è“‹åˆ° */
      }

      /* å¼•å°è¿½å•æ–‡å­— */
      .ai-card-question {
        font-size: 13px;
        color: #374151;
        line-height: 1.65;
        margin-bottom: 10px;
      }

      /* æ•¸æ“šåƒ¹å€¼æç¤ºï¼ˆå°å­—ç°è‰²ï¼‰ */
      .ai-card-data-hint {
        font-size: 12px;
        color: #9ca3af;
        line-height: 1.5;
        margin-bottom: 12px;
      }

      /* å¡ç‰‡åº•éƒ¨æŒ‰éˆ•å€ */
      .ai-card-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      /* ã€Œæ¡ç´å»ºè­°ã€æŒ‰éˆ• */
      .ai-card-adopt-btn {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 7px 14px;
        background: #00897b;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: "Noto Sans TC", sans-serif;
      }

      .ai-card-adopt-btn:hover {
        background: #00695c;
        transform: translateY(-1px);
      }

      .ai-card-adopt-btn:active {
        transform: translateY(0);
      }

      /* æŒ‰éˆ•å·²æ¡ç´ç‹€æ…‹ */
      .ai-card-adopt-btn.adopted {
        background: #10b981;
        cursor: default;
        transform: none;
      }

      /* ã€Œç•¥éã€æŒ‰éˆ•ï¼ˆæ–‡å­—é€£çµé¢¨æ ¼ï¼‰ */
      .ai-card-skip-btn {
        font-size: 12px;
        color: #9ca3af;
        background: none;
        border: none;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 6px;
        transition:
          color 0.2s ease,
          background 0.2s ease;
        font-family: "Noto Sans TC", sans-serif;
      }

      .ai-card-skip-btn:hover {
        color: #6b7280;
        background: rgba(0, 0, 0, 0.05);
      }

      /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
      @media (max-width: 480px) {
        .ai-card-label {
          font-size: 12px;
        }
        .ai-card-question {
          font-size: 12px;
        }
        .ai-card-adopt-btn {
          font-size: 12px;
          padding: 6px 12px;
        }
      }
    </style>
  </head>
  <body>
    <!-- ========================================
         ç‹€æ…‹ 1ï¼šå­¸ç”Ÿåˆ—è¡¨
         ======================================== -->
    <div id="view-list" class="view">
      <div class="page-container">
        <!-- é ‚éƒ¨æ¨™é¡Œåˆ— -->
        <div class="page-header">
          <a href="index.html" class="nav-back">â† é¦–é </a>
          <h1 class="page-title">å€‹æ¡ˆæœå‹™ç´€éŒ„</h1>
        </div>

        <!-- æœå°‹æ¡† -->
        <div class="search-wrapper">
          <input
            type="text"
            id="search-input"
            class="search-input"
            placeholder="ğŸ” æœå°‹å­¸ç”Ÿå§“å..."
            oninput="handleSearch(this.value)"
            autocomplete="off"
          />
        </div>

        <!-- å­¸ç”Ÿå¡ç‰‡åˆ—è¡¨ -->
        <div id="student-list" class="student-list"></div>

        <!-- ç„¡æœå°‹çµæœ -->
        <div id="no-results" class="empty-hint" style="display: none">
          æ‰¾ä¸åˆ°ç¬¦åˆã€Œ<span id="search-keyword"></span>ã€çš„å­¸ç”Ÿ
        </div>
      </div>
    </div>

    <!-- ========================================
         ç‹€æ…‹ 2ï¼šå­¸ç”Ÿå€‹åˆ¥é é¢
         ======================================== -->
    <div id="view-profile" class="view">
      <div class="page-container content-with-bottom-btn">
        <!-- é ‚éƒ¨å°è¦½ -->
        <div class="page-header">
          <span class="nav-back" onclick="showView('list')">â† è¿”å›åˆ—è¡¨</span>
          <h1 class="page-title" id="profile-name">å­¸ç”Ÿåå­—</h1>
        </div>

        <!-- åŸºæœ¬è³‡è¨Šå¡ç‰‡ -->
        <div class="card" style="margin-bottom: 14px">
          <!-- å§“å + é¢¨éšªç­‰ç´š -->
          <div class="info-row">
            <span class="info-label">å§“å</span>
            <div
              class="info-value"
              style="
                display: flex;
                align-items: center;
                gap: 8px;
                flex-wrap: wrap;
              "
            >
              <span id="profile-name-inline">â€”</span>
              <span id="profile-risk-tag" class="risk-tag">â€”</span>
            </div>
          </div>
          <!-- ç­ç´š -->
          <div class="info-row">
            <span class="info-label">ç­ç´š</span>
            <span class="info-value" id="profile-class">â€”</span>
          </div>
          <!-- è² è²¬ç¤¾å·¥ -->
          <div class="info-row">
            <span class="info-label">è² è²¬ç¤¾å·¥</span>
            <span class="info-value" id="profile-worker">â€”</span>
          </div>
          <!-- ç‰¹æ®Šå‚™è¨» -->
          <div class="info-row">
            <span class="info-label">ç‰¹æ®Šå‚™è¨»</span>
            <div id="profile-note" class="info-note">ç„¡</div>
          </div>
        </div>

        <!-- è¿‘æœŸç´€éŒ„æ™‚é–“è»¸ -->
        <div style="margin-bottom: 8px">
          <h2 class="section-title">ğŸ“‹ è¿‘æœŸæœå‹™ç´€éŒ„</h2>
          <div class="card" id="profile-records-card">
            <div id="profile-records"></div>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å›ºå®šã€Œæ–°å¢ç´€éŒ„ã€æŒ‰éˆ• -->
      <div class="bottom-fixed-area">
        <div class="bottom-fixed-inner">
          <button class="btn-primary" onclick="goToNewRecord()">
            ï¼‹ æ–°å¢ç´€éŒ„
          </button>
        </div>
      </div>
    </div>

    <!-- ========================================
         ç‹€æ…‹ 3ï¼šæ–°å¢è§€å¯Ÿç´€éŒ„
         ======================================== -->
    <div id="view-new-record" class="view">
      <div class="page-container content-with-bottom-btn">
        <!-- é ‚éƒ¨å°è¦½ -->
        <div class="page-header">
          <span class="nav-back" onclick="showView('profile')">â† è¿”å›</span>
          <h1 class="page-title">æ–°å¢è§€å¯Ÿç´€éŒ„</h1>
        </div>

        <!-- è¢«è¨˜éŒ„çš„å­¸ç”Ÿå -->
        <div
          style="
            margin-bottom: 14px;
            padding: 10px 14px;
            background: #e0f2f1;
            border-radius: 10px;
            font-size: 14px;
            color: #00695c;
            font-weight: 600;
          "
        >
          ğŸ“ æ­£åœ¨ç‚º
          <span id="new-record-name" style="font-weight: 700"></span> æ–°å¢ç´€éŒ„
        </div>

        <!-- è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå¯å¤šé¸ï¼‰ -->
        <div class="form-section card">
          <label class="form-label">è§€å¯Ÿé¢å‘ï¼ˆå¯å¤šé¸ï¼‰</label>
          <div id="tag-chips-area" class="tag-chips-area"></div>
        </div>

        <!-- ç°¡çŸ­æè¿°æ–‡å­—æ¡†ï¼ˆå« AI å³æ™‚å¼•å°ï¼‰ -->
        <div class="form-section card">
          <label class="form-label" for="record-note">è§€å¯Ÿæè¿°</label>
          <!-- æ–‡å­—æ¡†ä¸Šæ–¹æç¤ºï¼šå‘ŠçŸ¥å¿—å·¥ AI æœƒå³æ™‚å¼•å° -->
          <span class="ai-hint-text"
            >ğŸ’¡ è¼¸å…¥è§€å¯Ÿå…§å®¹å¾Œï¼ŒAI å°‡å³æ™‚åˆ†æä¸¦æä¾›åæ€å¼•å°</span
          >
          <textarea
            id="record-note"
            class="record-textarea"
            placeholder="è«‹æè¿°ä½ è§€å¯Ÿåˆ°çš„æƒ…æ³..."
            oninput="handleNoteInput()"
          ></textarea>
          <!-- AI åˆ†æä¸­çš„ç­‰å¾…æç¤ºï¼ˆå½ˆè·³åœ“é»ï¼‰ -->
          <div id="ai-analyzing" class="ai-analyzing">
            <span>ğŸ¤– AI åˆ†æä¸­</span>
            <div class="dot-bounce">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          <!-- AI å¼•å°å¡ç‰‡æœƒå‹•æ…‹æ’å…¥åˆ°é€™è£¡ -->
          <div id="ai-guidance-container" class="ai-guidance-container"></div>
        </div>

        <!-- Phase 2 é ç•™åŠŸèƒ½ï¼ˆç°è‰²ä¸å¯é»æ“Šï¼‰ -->
        <div class="form-section card">
          <label
            class="form-label"
            style="color: #9ca3af; font-weight: 600; font-size: 13px"
          >
            Phase 2 åŠŸèƒ½é å‘Š
          </label>
          <div class="phase2-buttons">
            <button class="btn-phase2">ğŸ¤ èªéŸ³è¼¸å…¥</button>
            <button class="btn-phase2">ğŸ¤– AI è¼”åŠ©æ•´ç†</button>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å›ºå®šã€Œå„²å­˜ç´€éŒ„ã€æŒ‰éˆ• -->
      <div class="bottom-fixed-area">
        <div class="bottom-fixed-inner">
          <button class="btn-primary" onclick="saveRecord()">
            âœ… å„²å­˜ç´€éŒ„
          </button>
        </div>
      </div>
    </div>

    <!-- ========================================
         å„²å­˜æˆåŠŸå‹•ç•«è¦†è“‹å±¤
         ======================================== -->
    <div id="success-overlay">
      <div class="success-icon">âœ…</div>
      <div class="success-text">ç´€éŒ„å·²å„²å­˜ï¼</div>
    </div>

    <!-- Toast æç¤ºå…ƒä»¶ -->
    <div id="toast" class="toast"></div>

    <!-- ========================================
         JavaScriptï¼šè‡ªå¸¶å‡è³‡æ–™ + äº’å‹•é‚è¼¯
         ======================================== -->
    <script>
      /* ============================================================
         å‡è³‡æ–™å€ï¼šå­¸ç”Ÿè³‡æ–™ï¼ˆ8 ä½ï¼‰
         ============================================================ */
      const STUDENTS = [
        {
          id: "s1",
          name: "ç‹å°æ˜",
          className: "å…‰æ˜åœ‹å° Aç­",
          risk: "high", // é«˜é¢¨éšª
          riskLabel: "ğŸ”´ é«˜é¢¨éšª",
          worker: "æ—ä½³ç© ç¤¾å·¥å¸«",
          note: "å®¶åº­ç‹€æ³éœ€é—œæ³¨ï¼Œå–®è¦ªå®¶åº­ï¼Œåª½åª½å·¥ä½œç¹å¿™ï¼Œæ”¾å­¸å¾Œå¸¸ç„¡äººç…§æ–™ã€‚",
          lastRecord: "2026/02/20",
        },
        {
          id: "s2",
          name: "é™³ç¾éº—",
          className: "å…‰æ˜åœ‹å° Aç­",
          risk: "stable", // ç©©å®š
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "æ—ä½³ç© ç¤¾å·¥å¸«",
          note: "æƒ…ç·’ç®¡ç†é€²æ­¥ä¸­ï¼Œè¿‘æœŸåœ¨èª²å ‚ä¸Šçš„åƒèˆ‡åº¦æ˜é¡¯æå‡ã€‚",
          lastRecord: "2026/02/21",
        },
        {
          id: "s3",
          name: "æå¤§è¯",
          className: "å¸Œæœ›åœ‹å° Bç­",
          risk: "watch", // éœ€é—œæ³¨
          riskLabel: "ğŸŸ¡ éœ€é—œæ³¨",
          worker: "å¼µå¿—æ˜ ç¤¾å·¥å¸«",
          note: "å­¸ç¿’è½å¾Œï¼Œå»ºè­°å®‰æ’èª²å¾Œè¼”å°ï¼Œé–±è®€ç†è§£èƒ½åŠ›éœ€åŠ å¼·ã€‚",
          lastRecord: "2026/02/19",
        },
        {
          id: "s4",
          name: "å¼µå¿—è±ª",
          className: "å¸Œæœ›åœ‹å° Bç­",
          risk: "stable",
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "å¼µå¿—æ˜ ç¤¾å·¥å¸«",
          note: "äººéš›é—œä¿‚è‰¯å¥½ï¼Œæ˜¯ç­ä¸Šçš„å°é ˜è¢–ï¼Œå–œæ­¡ç…§é¡§åŒå­¸ã€‚",
          lastRecord: "2026/02/22",
        },
        {
          id: "s5",
          name: "æ—å°èŠ¬",
          className: "é™½å…‰åœ‹å° Cç­",
          risk: "watch",
          riskLabel: "ğŸŸ¡ éœ€é—œæ³¨",
          worker: "é™³é›…çª ç¤¾å·¥å¸«",
          note: "æƒ…ç·’èµ·ä¼è¼ƒå¤§ï¼Œæœ€è¿‘å®¶è£¡æœ‰è®Šæ•…ï¼Œéœ€å¯†åˆ‡é—œæ³¨æƒ…ç·’ç‹€æ…‹ã€‚",
          lastRecord: "2026/02/18",
        },
        {
          id: "s6",
          name: "é»ƒæ–‡å‚‘",
          className: "é™½å…‰åœ‹å° Cç­",
          risk: "stable",
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "é™³é›…çª ç¤¾å·¥å¸«",
          note: "è¡¨ç¾ç©©å®šï¼Œå­¸ç¿’æ…‹åº¦ç©æ¥µï¼Œæœ¬å­¸æœŸé€²æ­¥é¡¯è‘—ã€‚",
          lastRecord: "2026/02/21",
        },
        {
          id: "s7",
          name: "å³ä½³ç©",
          className: "å…‰æ˜åœ‹å° Aç­",
          risk: "stable",
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "æ—ä½³ç© ç¤¾å·¥å¸«",
          note: "å€‹æ€§é–‹æœ—ï¼Œèª²å ‚äº’å‹•æ´»èºï¼Œèƒ½ä¸»å‹•å¹«åŠ©åŒå­¸ã€‚",
          lastRecord: "2026/02/22",
        },
        {
          id: "s8",
          name: "å‘¨å­ç‘œ",
          className: "å¸Œæœ›åœ‹å° Bç­",
          risk: "high",
          riskLabel: "ğŸ”´ é«˜é¢¨éšª",
          worker: "å¼µå¿—æ˜ ç¤¾å·¥å¸«",
          note: "é•·æœŸç¼ºèª²ï¼Œå®¶åº­ç¶“æ¿Ÿå›°é›£ï¼Œå·²é€šå ±ç¤¾æœƒå±€å”åŠ©ï¼Œéœ€æŒçºŒè¿½è¹¤ã€‚",
          lastRecord: "2026/02/17",
        },
      ];

      /* ============================================================
         å‡è³‡æ–™å€ï¼šå€‹æ¡ˆç´€éŒ„ï¼ˆæ¯ä½å­¸ç”Ÿè‡³å°‘ 3 ç­†ï¼‰
         ============================================================ */
      const CASE_RECORDS = {
        s1: [
          {
            date: "2026-02-20",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹", "ğŸ  å®¶åº­ç‹€æ³"],
            note: "ä»Šå¤©æƒ…ç·’æ˜é¡¯ä½è½ï¼Œå¹¾ä¹ä¸åƒèˆ‡è¨è«–ï¼Œä¸‹èª²å¾Œç•™ä¸‹ä¾†èŠäº†ä¸€ä¸‹ï¼Œèªªåª½åª½æœ€è¿‘å¾ˆå°‘å›å®¶ï¼Œç¨è‡ªä¸€äººåœ¨å®¶æ„Ÿåˆ°å®³æ€•ã€‚",
          },
          {
            date: "2026-02-14",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "èˆ‡åŒå­¸ç™¼ç”Ÿå£è§’ï¼Œèªªå°æ–¹èªªäº†å¾ˆé›£è½çš„è©±ã€‚ç¶“èª¿è§£å¾Œå’Œå¥½ï¼Œä½†ä»æœ‰äº›æ‚¶æ‚¶ä¸æ¨‚ï¼Œéœ€è¦æŒçºŒè§€å¯Ÿã€‚",
          },
          {
            date: "2026-02-07",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡", "ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "ä¸Šèª²ç™¼è¨€æ¬¡æ•¸æ˜é¡¯å¢åŠ ï¼Œä¸»å‹•èˆ‰æ‰‹å›ç­”å•é¡Œå…©æ¬¡ã€‚è€å¸«åæ˜ æœ€è¿‘å­¸ç¿’æ…‹åº¦æœ‰æ”¹å–„ã€‚",
          },
        ],
        s2: [
          {
            date: "2026-02-21",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ä»Šå¤©éå¸¸ç©æ¥µï¼Œä¸»å‹•èˆ‰æ‰‹ç™¼è¨€ï¼Œå›ç­”å•é¡Œä¹Ÿéƒ½å¾ˆæº–ç¢ºï¼ŒåŒå­¸çµ¦äº†ç†±çƒˆæŒè²ã€‚",
          },
          {
            date: "2026-02-15",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "æ•´å¤©å¿ƒæƒ…ä¸éŒ¯ï¼Œä¸‹èª²æ™‚é–‹å¿ƒåœ°è·ŸåŒå­¸åˆ†äº«é€±æœ«å‡ºéŠçš„æ•…äº‹ï¼Œæƒ…ç·’ç©©å®šã€‚",
          },
          {
            date: "2026-02-08",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "ä¸»å‹•é‚€è«‹è½‰å­¸ç”Ÿä¸€èµ·åƒåˆé¤ï¼Œå±•ç¾å¾ˆå¥½çš„åŒç†å¿ƒï¼Œæ˜¯ç­ä¸Šçš„æ¨¡ç¯„ã€‚",
          },
        ],
        s3: [
          {
            date: "2026-02-19",
            tags: ["ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "åœ‹èªè€ƒè©¦é€²æ­¥äº† 12 åˆ†ï¼çµ¦äºˆå¤§åŠ›é¼“å‹µã€‚ä½†æ•¸å­¸ä»æœ‰å›°é›£ï¼Œå»ºè­°åŠ å¼·ã€‚",
          },
          {
            date: "2026-02-12",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡", "ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "èª²å ‚åƒèˆ‡æ„é¡˜ä¸é«˜ï¼Œè©¢å•å¾Œèªªä¸å¤ªè½å¾—æ‡‚è€å¸«åœ¨èªªä»€éº¼ï¼Œå»ºè­°å®‰æ’è£œæ•‘æ•™å­¸ã€‚",
          },
          {
            date: "2026-02-05",
            tags: ["ğŸ  å®¶åº­ç‹€æ³"],
            note: "èˆ‡å®¶é•·é›»è©±è¯ç¹«ï¼Œäº†è§£åˆ°ä½œæ¥­å¸¸æ²’äººå¯ä»¥è¼”å°ï¼Œå·²å»ºè­°å­¸æ ¡å®‰æ’èª²å¾Œè¼”å°è³‡æºã€‚",
          },
        ],
        s4: [
          {
            date: "2026-02-22",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "ä»Šå¤©æ“”ä»»å°çµ„é•·å¸¶é ˜è¨è«–ï¼Œè¡¨ç¾éå¸¸ç¨±è·ï¼Œè¢«è€å¸«ç•¶ä½œå…¨ç­æ¦œæ¨£ã€‚",
          },
          {
            date: "2026-02-15",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ä¸»å‹•å¹«åŠ©é‚„æ²’å¯«å®Œä½œæ¥­çš„åŒå­¸è£œåŠŸèª²ï¼Œå¸«é•·éƒ½è®šç¾ä»–æ˜¯ç­ä¸Šçš„å°è€å¸«ã€‚",
          },
          {
            date: "2026-02-08",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹", "ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "æ®µè€ƒæˆç¸¾è¡¨ç¾å„ªç•°ï¼Œå¿ƒæƒ…é–‹æœ—ï¼Œå°å­¸ç¿’å……æ»¿å‹•åŠ›ï¼Œç¹¼çºŒä¿æŒã€‚",
          },
        ],
        s5: [
          {
            date: "2026-02-18",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹", "ğŸ  å®¶åº­ç‹€æ³"],
            note: "ä¸Šèª²æ™‚çªç„¶å“­æ³£ï¼Œå¸¶åˆ°è¼”å°å®¤é™ªä¼´èŠäº† 30 åˆ†é˜ã€‚èªªçˆ¶æ¯æœ€è¿‘åµæ¶å¾ˆå…‡ï¼Œç¡ä¸å¥½è¦ºã€‚",
          },
          {
            date: "2026-02-11",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "åˆä¼‘æ™‚é–“ä¸€å€‹äººååœ¨è§’è½ï¼Œä¸é¡˜æ„åŠ å…¥åŒå­¸çš„éŠæˆ²ã€‚å˜—è©¦å¼•å°å¥¹åˆ†äº«æ„Ÿå—ï¼Œèªªæ€•è¢«æ’æ“ ã€‚",
          },
          {
            date: "2026-02-04",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "åƒèˆ‡åº¦æ¯”ä¸Šé€±å¥½å¾ˆå¤šï¼Œæœ‰ä¸»å‹•èˆ‰æ‰‹ä¸€æ¬¡ï¼Œçµ¦äºˆå£é ­é¼“å‹µï¼Œå¸Œæœ›æŒçºŒç¶­æŒã€‚",
          },
        ],
        s6: [
          {
            date: "2026-02-21",
            tags: ["ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "æ•¸å­¸æ®µè€ƒ 95 åˆ†ï¼Œæœ¬å­¸æœŸæœ€å¥½çš„æˆç¸¾ï¼é–‹å¿ƒåœ°è·Ÿç¤¾å·¥ç‚«è€€ï¼Œçµ¦ä»–å¤§åŠ›é¼“å‹µã€‚",
          },
          {
            date: "2026-02-14",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ç¾å‹èª²è¡¨ç¾éå¸¸çªå‡ºï¼Œä½œå“ç²é¸å±•ç¤ºï¼Œè€å¸«ç‰¹åˆ¥ç¨±è®šä»–çš„å‰µæ„ã€‚",
          },
          {
            date: "2026-02-07",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•", "ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "å’ŒåŒå­¸ç›¸è™•èæ´½ï¼Œèª²é–“ä¸€èµ·æ‰“ç±ƒçƒï¼Œå¿ƒæƒ…æ„‰å¿«ï¼Œæƒ…ç·’ç‹€æ…‹ç©©å®šã€‚",
          },
        ],
        s7: [
          {
            date: "2026-02-22",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "ä»Šå¤©ç©æ¥µçµ„ç¹”åŒå­¸ä¸€èµ·ç·´ç¿’è©±åŠ‡ï¼Œå±•ç¾è‰¯å¥½çš„é ˜å°åŠ›ï¼ŒåŒå­¸å€‘éƒ½å¾ˆé–‹å¿ƒã€‚",
          },
          {
            date: "2026-02-17",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "å¿ƒæƒ…éå¸¸å¥½ï¼Œè€ƒè©¦è€ƒå¾—ä¸éŒ¯ï¼Œè·Ÿç¤¾å·¥åˆ†äº«èªªæ˜¯ç¬¬ä¸€æ¬¡è€ƒé€™éº¼é«˜åˆ†ï¼Œç¬‘å¾—å¾ˆé–‹å¿ƒã€‚",
          },
          {
            date: "2026-02-10",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡", "ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "èª²å ‚è¡¨ç¾ç©æ¥µï¼Œä¸»å‹•å›ç­”å•é¡Œï¼Œä½œæ¥­éƒ½æœ‰æŒ‰æ™‚å®Œæˆï¼Œå­¸ç¿’æ…‹åº¦å€¼å¾—è‚¯å®šã€‚",
          },
        ],
        s8: [
          {
            date: "2026-02-17",
            tags: ["ğŸ  å®¶åº­ç‹€æ³", "ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "ä»Šå¤©ç¸½ç®—ä¾†äº†ï¼Œç²¾ç¥ä¸å¤ªå¥½ï¼Œèªªå®¶è£¡æœ€è¿‘ç™¼ç”Ÿäº†å¾ˆå¤šäº‹ï¼Œè©³ç´°äº†è§£å¾Œå·²é€šå ±ç¤¾æœƒå±€å”åŠ©ã€‚",
          },
          {
            date: "2026-02-10",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ç¼ºå¸­ä¸€é€±å¾Œå›åˆ°å­¸æ ¡ï¼Œèª²å ‚ä¸Šå¹¾ä¹æ²’æœ‰åƒèˆ‡ï¼Œéœ€è¦ç‰¹åˆ¥é—œæ³¨é‡æ–°èå…¥ç­ç´šçš„æƒ…æ³ã€‚",
          },
          {
            date: "2026-02-03",
            tags: ["ğŸ  å®¶åº­ç‹€æ³"],
            note: "å®¶è¨ªæ™‚äº†è§£åˆ°å®¶åº­ç¶“æ¿Ÿå›°é›£ï¼Œå·²å”åŠ©ç”³è«‹æ€¥é›£æ•‘åŠ©é‡‘ï¼Œå¾ŒçºŒè¿½è¹¤ç”³è«‹é€²åº¦ã€‚",
          },
        ],
      };

      /* ============================================================
         è§€å¯Ÿé¢å‘æ¨™ç±¤é¸é …
         ============================================================ */
      const OBSERVATION_TAGS = [
        "ğŸ“š èª²å ‚åƒèˆ‡",
        "ğŸ‘¥ äººéš›äº’å‹•",
        "ğŸ’­ æƒ…ç·’ç‹€æ…‹",
        "ğŸ“– å­¸ç¿’è¡¨ç¾",
        "ğŸ  å®¶åº­ç‹€æ³",
      ];

      /* ============================================================
         ç‹€æ…‹ç®¡ç†
         ============================================================ */
      // ç›®å‰é¸ä¸­çš„å­¸ç”Ÿ
      let currentStudent = null;

      /* ============================================================
         å·¥å…·å‡½å¼ï¼šé¡¯ç¤º Toast æç¤º
         ============================================================ */
      function showToast(msg, duration) {
        duration = duration || 2200;
        var toast = document.getElementById("toast");
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(function () {
          toast.classList.remove("show");
        }, duration);
      }

      /* ============================================================
         å·¥å…·å‡½å¼ï¼šæ—¥æœŸæ ¼å¼åŒ–
         2026-02-20 â†’ 2/20
         ============================================================ */
      function formatDate(dateStr) {
        // ç§»é™¤å¹´ä»½å’Œå‰ç½®é›¶
        return dateStr.replace(/^\d{4}-0?(\d+)-0?(\d+)$/, "$1/$2");
      }

      /* ============================================================
         ç•«é¢åˆ‡æ›ï¼šå¸¶å‹•ç•«æ•ˆæœ
         ============================================================ */
      function showView(viewName) {
        // éš±è—æ‰€æœ‰ view
        var views = document.querySelectorAll(".view");
        for (var i = 0; i < views.length; i++) {
          views[i].classList.remove("active");
        }

        // é¡¯ç¤ºç›®æ¨™ view
        var target = document.getElementById("view-" + viewName);
        if (target) {
          target.classList.add("active");
          // å¥—ç”¨é€²å ´å‹•ç•«
          target.classList.remove("slide-in");
          void target.offsetWidth; // å¼·åˆ¶ reflow è®“å‹•ç•«é‡æ–°è§¸ç™¼
          target.classList.add("slide-in");
          // å›åˆ°é ‚éƒ¨
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      /* ============================================================
         ç‹€æ…‹ 1ï¼šæ¸²æŸ“å­¸ç”Ÿåˆ—è¡¨
         æ”¯æ´å³æ™‚æœå°‹ç¯©é¸
         ============================================================ */
      function renderStudentList(filterText) {
        filterText = (filterText || "").trim();

        var listEl = document.getElementById("student-list");
        var noResultsEl = document.getElementById("no-results");
        var keywordEl = document.getElementById("search-keyword");

        // ç¯©é¸é‚è¼¯ï¼šæ¯”å°å­¸ç”Ÿå§“å
        var filtered = filterText
          ? STUDENTS.filter(function (s) {
              return s.name.indexOf(filterText) !== -1;
            })
          : STUDENTS;

        // ç„¡çµæœ
        if (filtered.length === 0) {
          listEl.innerHTML = "";
          noResultsEl.style.display = "block";
          keywordEl.textContent = filterText;
          return;
        }

        noResultsEl.style.display = "none";

        // æ¸²æŸ“å¡ç‰‡
        var html = "";
        for (var i = 0; i < filtered.length; i++) {
          var s = filtered[i];

          // è¨ˆç®—é¢¨éšªæ¨™ç±¤æ¨£å¼
          var riskClass =
            s.risk === "high"
              ? "risk-high"
              : s.risk === "watch"
                ? "risk-watch"
                : "risk-stable";

          // å–æœ€è¿‘ç´€éŒ„æ—¥æœŸ
          var records = CASE_RECORDS[s.id] || [];
          var latestDate = null;
          if (records.length > 0) {
            // ä¾æ—¥æœŸæ’åºå–æœ€æ–°
            var sorted = records.slice().sort(function (a, b) {
              return b.date.localeCompare(a.date);
            });
            latestDate = sorted[0].date;
          }
          var dateDisplay = latestDate
            ? "æœ€è¿‘ï¼š" + formatDate(latestDate)
            : "å°šç„¡ç´€éŒ„";

          // å¡ç‰‡ HTMLï¼ˆäº¤éŒ¯å‹•ç•«é  CSS å»¶é²ï¼‰
          html +=
            '<div class="card card-clickable" ' +
            'style="animation: staggerIn 0.4s ease ' +
            i * 0.07 +
            's both;" ' +
            "onclick=\"goToProfile('" +
            s.id +
            "')\">";

          html += '<div class="student-card-name">' + s.name + "</div>";
          html +=
            '<div class="student-card-class">ğŸ« ' + s.className + "</div>";

          html += '<div class="student-card-footer">';
          html +=
            '<span class="risk-tag ' +
            riskClass +
            '">' +
            s.riskLabel +
            "</span>";
          html +=
            '<span class="last-record-date' +
            (latestDate ? " has-record" : "") +
            '">' +
            dateDisplay +
            "</span>";
          html += "</div>";

          html += "</div>";
        }

        listEl.innerHTML = html;
      }

      /* ============================================================
         æœå°‹æ¡† oninput è™•ç†
         ============================================================ */
      function handleSearch(value) {
        renderStudentList(value);
      }

      /* ============================================================
         ç‹€æ…‹ 2ï¼šé€²å…¥å­¸ç”Ÿå€‹åˆ¥é é¢
         ============================================================ */
      function goToProfile(studentId) {
        // æ‰¾åˆ°å­¸ç”Ÿè³‡æ–™
        currentStudent = null;
        for (var i = 0; i < STUDENTS.length; i++) {
          if (STUDENTS[i].id === studentId) {
            currentStudent = STUDENTS[i];
            break;
          }
        }
        if (!currentStudent) return;

        // å¡«å…¥åŸºæœ¬è³‡è¨Š
        document.getElementById("profile-name").textContent =
          currentStudent.name;
        document.getElementById("profile-name-inline").textContent =
          currentStudent.name;
        document.getElementById("profile-class").textContent =
          currentStudent.className;
        document.getElementById("profile-worker").textContent =
          currentStudent.worker;

        // é¢¨éšªç­‰ç´šæ¨™ç±¤
        var riskTag = document.getElementById("profile-risk-tag");
        riskTag.textContent = currentStudent.riskLabel;
        riskTag.className =
          "risk-tag " +
          (currentStudent.risk === "high"
            ? "risk-high"
            : currentStudent.risk === "watch"
              ? "risk-watch"
              : "risk-stable");

        // ç‰¹æ®Šå‚™è¨»
        document.getElementById("profile-note").textContent =
          currentStudent.note || "ç„¡ç‰¹æ®Šå‚™è¨»";

        // æ¸²æŸ“ç´€éŒ„æ™‚é–“è»¸
        renderProfileRecords(studentId, false);

        // åˆ‡æ›åˆ°å€‹åˆ¥é é¢
        showView("profile");
      }

      /* ============================================================
         æ¸²æŸ“å­¸ç”Ÿçš„æœå‹™ç´€éŒ„æ™‚é–“è»¸
         highlightFirstï¼šæ˜¯å¦é«˜äº®æœ€æ–°ä¸€ç­†ï¼ˆæ–°å¢å¾Œä½¿ç”¨ï¼‰
         ============================================================ */
      function renderProfileRecords(studentId, highlightFirst) {
        var records = CASE_RECORDS[studentId] || [];
        var container = document.getElementById("profile-records");

        if (records.length === 0) {
          container.innerHTML =
            '<div class="empty-hint">ğŸ“­ å°šç„¡æœå‹™ç´€éŒ„<br><span style="font-size:12px;margin-top:6px;display:block;">é»æ“Šä¸‹æ–¹ã€Œæ–°å¢ç´€éŒ„ã€é–‹å§‹è¨˜éŒ„</span></div>';
          return;
        }

        // ä¾æ—¥æœŸé™åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨ä¸Šæ–¹ï¼‰
        var sorted = records.slice().sort(function (a, b) {
          return b.date.localeCompare(a.date);
        });

        var html = '<div class="record-timeline">';
        for (var i = 0; i < sorted.length; i++) {
          var r = sorted[i];
          var isLatest = i === 0;
          var highlightClass =
            highlightFirst && isLatest ? " new-highlight" : "";
          var latestClass = isLatest ? " latest" : "";

          html +=
            '<div class="record-item' + latestClass + highlightClass + '">';

          // æ—¥æœŸ + æ¨™ç±¤
          html += '<div class="record-meta">';
          html +=
            '<span class="record-date-label">ğŸ“… ' +
            formatDate(r.date) +
            "</span>";
          // è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå¯èƒ½å¤šå€‹ï¼‰
          var tags = r.tags || [];
          for (var t = 0; t < tags.length; t++) {
            html += '<span class="tag-small">' + tags[t] + "</span>";
          }
          html += "</div>";

          // æè¿°å…§å®¹
          html += '<p class="record-note-text">' + r.note + "</p>";

          html += "</div>";
        }
        html += "</div>";

        container.innerHTML = html;
      }

      /* ============================================================
         é€²å…¥ç‹€æ…‹ 3ï¼šæ–°å¢ç´€éŒ„
         ============================================================ */
      function goToNewRecord() {
        if (!currentStudent) return;

        // é¡¯ç¤ºè¢«è¨˜éŒ„çš„å­¸ç”Ÿå
        document.getElementById("new-record-name").textContent =
          currentStudent.name;

        // æ¸…ç©ºæ–‡å­—æ¡†
        document.getElementById("record-note").value = "";

        // é‡ç½® AI å¼•å°ç›¸é—œç‹€æ…‹ï¼ˆæ¸…é™¤è¨ˆæ™‚å™¨ã€å¡ç‰‡ã€åˆ†ææç¤ºï¼‰
        if (typeof clearAllAiGuidance === "function") {
          clearAllAiGuidance();
        }

        // æ¸²æŸ“è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå…¨éƒ¨åˆå§‹ç‚ºæœªé¸ä¸­ï¼‰
        var tagArea = document.getElementById("tag-chips-area");
        var tagHtml = "";
        for (var i = 0; i < OBSERVATION_TAGS.length; i++) {
          tagHtml +=
            '<span class="tag-chip" onclick="toggleTag(this)">' +
            OBSERVATION_TAGS[i] +
            "</span>";
        }
        tagArea.innerHTML = tagHtml;

        showView("new-record");
      }

      /* ============================================================
         è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼šé»æ“Šåˆ‡æ›é¸å–ç‹€æ…‹
         ============================================================ */
      function toggleTag(el) {
        el.classList.toggle("selected");
      }

      /* ============================================================
         å„²å­˜æ–°ç´€éŒ„
         ============================================================ */
      function saveRecord() {
        // æ”¶é›†å·²é¸å–çš„æ¨™ç±¤
        var selectedEls = document.querySelectorAll(
          "#tag-chips-area .tag-chip.selected",
        );
        var selectedTags = [];
        for (var i = 0; i < selectedEls.length; i++) {
          selectedTags.push(selectedEls[i].textContent.trim());
        }

        // å–å¾—æè¿°å…§å®¹
        var note = document.getElementById("record-note").value.trim();

        // é©—è­‰ï¼šè‡³å°‘é¸ä¸€å€‹é¢å‘
        if (selectedTags.length === 0) {
          showToast("âš ï¸ è«‹è‡³å°‘é¸æ“‡ä¸€å€‹è§€å¯Ÿé¢å‘");
          return;
        }

        // é©—è­‰ï¼šæè¿°ä¸èƒ½ç©ºç™½
        if (!note) {
          showToast("âš ï¸ è«‹æè¿°ä½ è§€å¯Ÿåˆ°çš„æƒ…æ³");
          return;
        }

        // å–å¾—ä»Šå¤©æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
        var today = new Date().toISOString().split("T")[0];

        // å»ºç«‹æ–°ç´€éŒ„ç‰©ä»¶
        var newRecord = {
          date: today,
          tags: selectedTags,
          note: note,
        };

        // å­˜å…¥è¨˜æ†¶é«”ï¼ˆprepend åˆ°é™£åˆ—æœ€å‰é¢ï¼Œé¡¯ç¤ºåœ¨æ™‚é–“è»¸é ‚éƒ¨ï¼‰
        var sid = currentStudent.id;
        if (!CASE_RECORDS[sid]) {
          CASE_RECORDS[sid] = [];
        }
        CASE_RECORDS[sid].unshift(newRecord);

        // é¡¯ç¤ºæˆåŠŸå‹•ç•«
        showSuccessAnimation(function () {
          // å‹•ç•«çµæŸå¾Œè¿”å›å€‹åˆ¥é é¢ï¼Œä¸¦é«˜äº®æœ€æ–°ç´€éŒ„
          renderProfileRecords(sid, true);
          showView("profile");
        });
      }

      /* ============================================================
         æˆåŠŸå‹•ç•«ï¼šé¡¯ç¤ºæ‰“å‹¾ + ç¶ è‰²é–ƒç¾
         callbackï¼šå‹•ç•«çµæŸå¾ŒåŸ·è¡Œ
         ============================================================ */
      function showSuccessAnimation(callback) {
        var overlay = document.getElementById("success-overlay");
        overlay.classList.add("show");

        // 1.2 ç§’å¾Œéš±è—
        setTimeout(function () {
          overlay.classList.remove("show");
          if (callback) callback();
        }, 1200);
      }

      /* ============================================================
         AI å³æ™‚åæ€å¼•å°ç³»çµ±
         ============================================================ */

      /* ä¸‰å€‹æƒ…å¢ƒçš„å®šç¾©ï¼šé—œéµå­—ã€å¡ç‰‡æ¨£å¼ã€å¼•å°å…§å®¹ */
      var AI_SCENARIOS = [
        {
          /* æƒ…å¢ƒäºŒï¼ˆå„ªå…ˆç´šæœ€é«˜ï¼‰ï¼šé«˜é¢¨éšªé è­¦ â€” å®¶åº­ç–å¿½ */
          id: "risk",
          priority: 1,
          keywords: [
            "ç‰¹åˆ¥ç´¯",
            "å‘³é“",
            "ä¸æƒ³åƒ",
            "å—å‚·",
            "ç˜€é’",
            "é«’",
            "æ²’åƒæ—©é¤",
          ],
          cardClass: "ai-card-risk",
          label: "âš ï¸ ç³»çµ±é‡è¦æé†’ â€” ç–‘ä¼¼ç”Ÿæ´»ç…§é¡§ç–å¿½",
          question:
            "åµæ¸¬åˆ°ç–‘ä¼¼ã€Œç”Ÿæ´»ç…§é¡§ç–å¿½ã€æŒ‡æ¨™ã€‚è«‹æ‚¨å›æƒ³ä¸¦è£œå……ï¼šå­¸ç«¥æ˜¯å¦æœ‰æåŠæ˜¨æ™šå®¶è£¡çš„ç‹€æ³ï¼Ÿæ˜¯å¦æœ‰ç™¼ç¾å­¸ç«¥èº«ä¸Šæœ‰å…¶ä»–ç•°å¸¸å¤–å‚·ï¼Ÿ",
          dataHint: "ğŸ“Š æ‚¨è£œå……çš„è³‡è¨Šå°‡å„ªå…ˆåŒæ­¥çµ¦å„æ ¡ç£å°ï¼Œå”åŠ©åŠæ™‚ä»‹å…¥",
          /* æ¡ç´å¾Œæ’å…¥æ–‡å­—æ¡†çš„å¼•å°è£œå……æ¨¡æ¿ */
          template:
            "\n\n---\nã€AI å¼•å°è£œå……ã€‘\nå­¸ç«¥æåŠçš„å®¶åº­ç‹€æ³ï¼š\nèº«é«”å¤–è§€ç•°å¸¸è§€å¯Ÿï¼š\næ˜¯å¦éœ€è¦é€šå ±ï¼š",
        },
        {
          /* æƒ…å¢ƒä¸€ï¼ˆå„ªå…ˆç´šç¬¬äºŒï¼‰ï¼šå­¸ç¿’æŒ«æŠ˜èˆ‡æƒ…ç·’ */
          id: "emotion",
          priority: 2,
          keywords: [
            "ä¸å°ˆå¿ƒ",
            "ç™¼è„¾æ°£",
            "å¤§ç™¼è„¾æ°£",
            "æƒ…ç·’å¤±æ§",
            "å“­",
            "ç”Ÿæ°£",
            "æ‰“äºº",
          ],
          cardClass: "ai-card-emotion",
          label: "ğŸ”´ åµæ¸¬åˆ°æƒ…ç·’æ³¢å‹•",
          question:
            "åµæ¸¬åˆ°å­¸ç«¥æœ‰å¼·çƒˆçš„æƒ…ç·’æ³¢å‹•ã€‚è«‹å•ç™¼è„¾æ°£å‰ï¼Œæ˜¯å¦æœ‰é‡åˆ°ç‰¹å®šçš„é¡Œå‹å¡é—œï¼Ÿæ‚¨ç•¶ä¸‹ä½¿ç”¨äº†ä»€éº¼æ–¹å¼ï¼ˆå¦‚ï¼šè½‰ç§»æ³¨æ„åŠ›ã€æ‹†è§£æ­¥é©Ÿï¼‰ä¾†å®‰æ’«ä»–ï¼Œä¸”æ•ˆæœå¦‚ä½•ï¼Ÿ",
          dataHint: "ğŸ“Š è£œå……å¾Œå¯å”åŠ©ç£å°é‡æ¸…æ˜¯å­¸ç¿’éšœç¤™é‚„æ˜¯ç´”æƒ…ç·’å•é¡Œ",
          template:
            "\n\n---\nã€AI å¼•å°è£œå……ã€‘\næƒ…ç·’çˆ†ç™¼çš„è§¸ç™¼é»ï¼š\nä½¿ç”¨çš„å®‰æ’«æ–¹å¼ï¼š\næ•ˆæœè©•ä¼°ï¼š",
        },
        {
          /* æƒ…å¢ƒä¸‰ï¼ˆå„ªå…ˆç´šæœ€ä½ï¼‰ï¼šæ­£å‘è¡Œç‚ºèˆ‡ç­ç´šæ°›åœ */
          id: "positive",
          priority: 3,
          keywords: ["æ°£æ°›å¥½", "å¾ˆæ£’", "é€²æ­¥", "å¹«å¿™", "é–‹å¿ƒ", "ä¸»å‹•", "åˆä½œ"],
          cardClass: "ai-card-positive",
          label: "ğŸŒŸ æ­£å‘è¡Œç‚ºç´€éŒ„",
          question:
            "å¤ªæ£’äº†ï¼ç‚ºäº†å…·é«”è¨˜éŒ„å­©å­çš„æˆé•·ï¼Œè«‹å•ä»Šå¤©æ‚¨ä½¿ç”¨äº†ä»€éº¼ç‰¹åˆ¥çš„ç­ç´šç¶“ç‡ŸæŠ€å·§ï¼ˆå¦‚ï¼šåˆ†çµ„ç«¶è³½ã€ä»£å¹£çå‹µï¼‰è®“æ°£æ°›è®Šå¥½ï¼Ÿé€™ä½åŒå­¸çš„ä¸»å‹•å¹«å¿™ï¼Œè·Ÿéå»ç›¸æ¯”æœ‰ä»€éº¼çªç ´å—ï¼Ÿ",
          dataHint: "ğŸ“Š å…·é«”è¨˜éŒ„å¯å»ºç«‹ç­ç´šæ­£å‘ç¶“ç‡Ÿçš„æˆåŠŸæ¡ˆä¾‹åº«",
          template:
            "\n\n---\nã€AI å¼•å°è£œå……ã€‘\nä½¿ç”¨çš„ç­ç´šç¶“ç‡ŸæŠ€å·§ï¼š\nå­¸ç«¥çš„å…·é«”çªç ´ï¼š\nå¾ŒçºŒè·Ÿé€²è¨ˆç•«ï¼š",
        },
      ];

      /* ç›®å‰é¡¯ç¤ºçš„å¡ç‰‡æƒ…å¢ƒ ID */
      var currentCardScenarioId = null;

      /* debounce è¨ˆæ™‚å™¨ï¼ˆç”¨ä¾†å»¶é² 800ms æ‰é¡¯ç¤ºå¡ç‰‡ï¼‰ */
      var aiDebounceTimer = null;

      /* ============================================================
         è™•ç†æ–‡å­—æ¡†è¼¸å…¥äº‹ä»¶ï¼ˆdebounce 800msï¼‰
         ============================================================ */
      function handleNoteInput() {
        var text = document.getElementById("record-note").value;

        /* è‹¥æ–‡å­—æ¡†æ˜¯ç©ºçš„ï¼Œæ¸…é™¤æ‰€æœ‰ AI å¼•å° */
        if (!text.trim()) {
          clearAllAiGuidance();
          return;
        }

        /* æ¸…é™¤ä¸Šä¸€å€‹ debounce è¨ˆæ™‚å™¨ */
        if (aiDebounceTimer) {
          clearTimeout(aiDebounceTimer);
          aiDebounceTimer = null;
        }

        /* å…ˆåµæ¸¬é—œéµå­—ï¼Œæ‰¾å‡ºå„ªå…ˆç´šæœ€é«˜çš„æƒ…å¢ƒ */
        var matchedScenario = detectScenario(text);

        if (!matchedScenario) {
          /* æ²’æœ‰åŒ¹é…çš„é—œéµå­—ï¼šé—œé–‰å¡ç‰‡å’Œ loading */
          hideAnalyzing();
          if (currentCardScenarioId) {
            hideCurrentCard(function () {
              currentCardScenarioId = null;
            });
          }
          return;
        }

        /* å¦‚æœå·²ç¶“é¡¯ç¤ºçš„æ˜¯åŒä¸€å€‹æƒ…å¢ƒï¼Œä¸é‡è¤‡è§¸ç™¼ */
        if (currentCardScenarioId === matchedScenario.id) {
          return;
        }

        /* é¡¯ç¤ºã€ŒAI åˆ†æä¸­...ã€æç¤º */
        showAnalyzing();

        /* å»¶é² 800ms å¾Œé¡¯ç¤º AI å¼•å°å¡ç‰‡ï¼ˆæ¨¡æ“¬ AI åˆ†ææ™‚é–“ï¼‰ */
        aiDebounceTimer = setTimeout(function () {
          hideAnalyzing();
          showAiCard(matchedScenario);
        }, 800);
      }

      /* ============================================================
         åµæ¸¬æ–‡å­—ä¸­çš„é—œéµå­—ï¼Œå›å‚³å„ªå…ˆç´šæœ€é«˜çš„æƒ…å¢ƒ
         ============================================================ */
      function detectScenario(text) {
        var matched = null;

        for (var i = 0; i < AI_SCENARIOS.length; i++) {
          var scenario = AI_SCENARIOS[i];
          var keywords = scenario.keywords;

          /* é€ä¸€æª¢æŸ¥é—œéµå­—ï¼ˆç”¨ includes ç°¡å–®åŒ¹é…ï¼‰ */
          for (var k = 0; k < keywords.length; k++) {
            if (text.includes(keywords[k])) {
              /* æ‰¾åˆ°åŒ¹é…ï¼ç¢ºèªæ˜¯å¦æ¯”ç›®å‰æš«å­˜çš„å„ªå…ˆç´šæ›´é«˜ */
              if (!matched || scenario.priority < matched.priority) {
                matched = scenario;
              }
              break; /* åŒä¸€å€‹æƒ…å¢ƒåªéœ€åŒ¹é…åˆ°ä¸€å€‹é—œéµå­—å°±å¤  */
            }
          }
        }

        return matched;
      }

      /* ============================================================
         é¡¯ç¤ºã€ŒAI åˆ†æä¸­...ã€ç­‰å¾…æç¤º
         ============================================================ */
      function showAnalyzing() {
        var el = document.getElementById("ai-analyzing");
        if (el) el.classList.add("visible");
      }

      /* ============================================================
         éš±è—ã€ŒAI åˆ†æä¸­...ã€ç­‰å¾…æç¤º
         ============================================================ */
      function hideAnalyzing() {
        var el = document.getElementById("ai-analyzing");
        if (el) el.classList.remove("visible");
      }

      /* ============================================================
         é¡¯ç¤º AI å¼•å°å¡ç‰‡ï¼ˆèˆŠå¡ç‰‡å…ˆæ·¡å‡ºï¼Œæ–°å¡ç‰‡æ·¡å…¥ï¼‰
         ============================================================ */
      function showAiCard(scenario) {
        var container = document.getElementById("ai-guidance-container");
        if (!container) return;

        /* å¦‚æœå·²æœ‰å¡ç‰‡ï¼Œå…ˆæ·¡å‡ºå†é¡¯ç¤ºæ–°å¡ç‰‡ */
        var existingCard = container.querySelector(".ai-guidance-card");
        if (existingCard) {
          existingCard.classList.add("hiding");
          setTimeout(function () {
            container.innerHTML = "";
            renderAiCard(container, scenario);
            currentCardScenarioId = scenario.id;
          }, 260);
        } else {
          renderAiCard(container, scenario);
          currentCardScenarioId = scenario.id;
        }
      }

      /* ============================================================
         æ¸²æŸ“ AI å¼•å°å¡ç‰‡ HTML
         ============================================================ */
      function renderAiCard(container, scenario) {
        /* å»ºç«‹å¡ç‰‡å…ƒç´  */
        var card = document.createElement("div");
        card.className = "ai-guidance-card " + scenario.cardClass;
        card.setAttribute("data-scenario-id", scenario.id);

        /* å³ä¸Šè§’ AI æ¨™ç¤º */
        var badge = document.createElement("span");
        badge.className = "ai-card-badge";
        badge.textContent = "ğŸ¤– AI å¼•å°";
        card.appendChild(badge);

        /* å¡ç‰‡æ¨™ç±¤ */
        var label = document.createElement("div");
        label.className = "ai-card-label";
        label.textContent = scenario.label;
        card.appendChild(label);

        /* å¼•å°è¿½å• */
        var question = document.createElement("div");
        question.className = "ai-card-question";
        question.textContent = scenario.question;
        card.appendChild(question);

        /* æ•¸æ“šåƒ¹å€¼æç¤º */
        var dataHint = document.createElement("div");
        dataHint.className = "ai-card-data-hint";
        dataHint.textContent = scenario.dataHint;
        card.appendChild(dataHint);

        /* æŒ‰éˆ•å€ */
        var actions = document.createElement("div");
        actions.className = "ai-card-actions";

        /* æ¡ç´å»ºè­°æŒ‰éˆ•ï¼ˆé–‰åŒ…ç¶å®š scenarioï¼‰ */
        var adoptBtn = document.createElement("button");
        adoptBtn.className = "ai-card-adopt-btn";
        adoptBtn.textContent = "æ¡ç´å»ºè­°ï¼Œè£œå……æè¿° âœï¸";
        adoptBtn.onclick = (function (s, btn) {
          return function () {
            adoptAiSuggestion(s, btn);
          };
        })(scenario, adoptBtn);
        actions.appendChild(adoptBtn);

        /* ç•¥éæŒ‰éˆ• */
        var skipBtn = document.createElement("button");
        skipBtn.className = "ai-card-skip-btn";
        skipBtn.textContent = "ç•¥é";
        skipBtn.onclick = function () {
          hideCurrentCard(function () {
            currentCardScenarioId = null;
          });
        };
        actions.appendChild(skipBtn);

        card.appendChild(actions);

        /* æ’å…¥å®¹å™¨ */
        container.appendChild(card);
      }

      /* ============================================================
         æ¡ç´ AI å»ºè­°ï¼šåœ¨æ–‡å­—æ¡†ä¸­è¿½åŠ å¼•å°è£œå……æ¨¡æ¿
         ============================================================ */
      function adoptAiSuggestion(scenario, btn) {
        /* æŒ‰éˆ•ç‹€æ…‹æ”¹ç‚ºã€Œå·²æ¡ç´ã€ */
        btn.textContent = "âœ… å·²æ¡ç´";
        btn.classList.add("adopted");
        btn.onclick = null; /* é˜²æ­¢é‡è¤‡é»æ“Š */

        /* åœ¨æ–‡å­—æ¡†è¿½åŠ å¼•å°æ¨¡æ¿ */
        var textarea = document.getElementById("record-note");
        if (textarea) {
          textarea.value = textarea.value + scenario.template;
          /* è®“æ–‡å­—æ¡†è‡ªå‹•æ²åˆ°åº•éƒ¨ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…ç¹¼çºŒè¼¸å…¥ */
          textarea.scrollTop = textarea.scrollHeight;
          /* èšç„¦åˆ°æ–‡å­—æ¡†ï¼Œè®“ä½¿ç”¨è€…ç›´æ¥ç¹¼çºŒè¼¸å…¥ */
          textarea.focus();
          /* æŠŠæ¸¸æ¨™ç§»åˆ°æœ€æœ«ç«¯ */
          var len = textarea.value.length;
          textarea.setSelectionRange(len, len);
        }
      }

      /* ============================================================
         éš±è—ç›®å‰é¡¯ç¤ºçš„å¡ç‰‡ï¼ˆå¸¶é€€å ´å‹•ç•«ï¼‰
         ============================================================ */
      function hideCurrentCard(callback) {
        var container = document.getElementById("ai-guidance-container");
        if (!container) return;

        var card = container.querySelector(".ai-guidance-card");
        if (card) {
          card.classList.add("hiding");
          setTimeout(function () {
            container.innerHTML = "";
            if (callback) callback();
          }, 260);
        } else {
          if (callback) callback();
        }
      }

      /* ============================================================
         æ¸…é™¤æ‰€æœ‰ AI å¼•å°ï¼ˆæ–‡å­—æ¡†æ¸…ç©ºæ™‚å‘¼å«ï¼‰
         ============================================================ */
      function clearAllAiGuidance() {
        /* æ¸…é™¤ debounce è¨ˆæ™‚å™¨ */
        if (aiDebounceTimer) {
          clearTimeout(aiDebounceTimer);
          aiDebounceTimer = null;
        }

        /* éš±è—åˆ†ææç¤º */
        hideAnalyzing();

        /* ç§»é™¤å¡ç‰‡ */
        var container = document.getElementById("ai-guidance-container");
        if (container) {
          container.innerHTML = "";
        }

        currentCardScenarioId = null;
      }

      /* ============================================================
         é€²å…¥ç‹€æ…‹ 3 æ™‚ï¼Œé‡ç½® AI å¼•å°ç‹€æ…‹
         ============================================================ */
      var _originalGoToNewRecord = goToNewRecord;
      goToNewRecord = function () {
        /* é‡ç½® AI å¼•å°ç‹€æ…‹ */
        clearAllAiGuidance();
        currentCardScenarioId = null;
        /* å‘¼å«åŸæœ¬çš„ goToNewRecord */
        _originalGoToNewRecord.call(this);
      };

      /* ============================================================
         é é¢åˆå§‹åŒ–
         ============================================================ */
      document.addEventListener("DOMContentLoaded", function () {
        // æ¸²æŸ“å­¸ç”Ÿåˆ—è¡¨ä¸¦é¡¯ç¤ºç‹€æ…‹ 1
        renderStudentList();
        showView("list");
      });
    </script>
  </body>
</html>
