<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å€‹æ¡ˆæœå‹™ç´€éŒ„ â€” æ°¸é½¡å¸Œæœ›å°å­¸</title>
    <!-- Google Fontsï¼šNoto Sans TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* ===== å…¨åŸŸåŸºç¤ ===== */
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: #f8fafc;
        color: #1f2937;
        margin: 0;
        padding: 0;
      }

      /* ===== é é¢å®¹å™¨ ===== */
      .page-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 24px 16px;
        min-height: 100vh;
      }

      /* ===== ç•«é¢åˆ‡æ›å‹•ç•« ===== */
      /* æ¯å€‹ç‹€æ…‹éƒ½æ˜¯ç¨ç«‹çš„ viewï¼Œé€é JS æ§åˆ¶ active */
      .view {
        display: none;
        opacity: 0;
        transition: opacity 0.35s ease;
      }

      .view.active {
        display: block;
        opacity: 1;
      }

      /* é€²å ´å‹•ç•«ï¼ˆç”¨ JS è§¸ç™¼ï¼‰ */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .slide-in {
        animation: slideInUp 0.35s ease forwards;
      }

      /* å¡ç‰‡äº¤éŒ¯é€²å ´ï¼ˆstaggered animationï¼‰ */
      @keyframes staggerIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ===== é ‚éƒ¨å°è¦½åˆ— ===== */
      .page-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .page-title {
        font-size: 20px;
        font-weight: 700;
        color: #1f2937;
        flex: 1;
      }

      /* è¿”å›æŒ‰éˆ• */
      .nav-back {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        color: #6366f1;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        padding: 8px 0;
        text-decoration: none;
        flex-shrink: 0;
        transition: color 0.2s ease;
      }

      .nav-back:hover {
        color: #4f46e5;
      }

      /* ===== æœå°‹æ¡† ===== */
      .search-wrapper {
        margin-bottom: 16px;
      }

      .search-input {
        width: 100%;
        padding: 11px 16px 11px 42px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 15px;
        outline: none;
        transition: border-color 0.2s ease;
        font-family: "Noto Sans TC", sans-serif;
        background-color: #ffffff;
        /* æœå°‹åœ–ç¤ºï¼ˆSVG inlineï¼‰ */
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239CA3AF'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: 12px center;
        background-size: 20px;
        color: #1f2937;
      }

      .search-input::placeholder {
        color: #9ca3af;
      }

      .search-input:focus {
        border-color: #6366f1;
      }

      /* ===== å¡ç‰‡åŸºç¤æ¨£å¼ ===== */
      .card {
        background: #ffffff;
        border-radius: 12px;
        box-shadow:
          0 1px 3px rgba(0, 0, 0, 0.08),
          0 1px 2px rgba(0, 0, 0, 0.05);
        padding: 16px;
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease;
      }

      /* å¯é»æ“Šçš„å¡ç‰‡ */
      .card-clickable {
        cursor: pointer;
      }

      .card-clickable:hover {
        transform: translateY(-2px);
        box-shadow:
          0 6px 20px rgba(99, 102, 241, 0.12),
          0 2px 6px rgba(0, 0, 0, 0.08);
      }

      .card-clickable:active {
        transform: translateY(0);
      }

      /* ===== å­¸ç”Ÿåˆ—è¡¨å¡ç‰‡ ===== */
      .student-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .student-card-name {
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 3px;
      }

      .student-card-class {
        font-size: 13px;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .student-card-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 6px;
      }

      .tags-group {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        align-items: center;
      }

      .last-record-date {
        font-size: 12px;
        color: #9ca3af;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .last-record-date.has-record {
        color: #6b7280;
      }

      /* ===== é¢¨éšªç­‰ç´šæ¨™ç±¤ ===== */
      /* ç©©å®šï¼ˆç¶ ï¼‰ */
      .risk-tag {
        display: inline-flex;
        align-items: center;
        gap: 3px;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
      }

      .risk-stable {
        background: #d1fae5;
        color: #065f46;
      }

      /* éœ€é—œæ³¨ï¼ˆé»ƒï¼‰ */
      .risk-watch {
        background: #fef3c7;
        color: #92400e;
      }

      /* é«˜é¢¨éšªï¼ˆç´…ï¼‰ */
      .risk-high {
        background: #fee2e2;
        color: #991b1b;
      }

      /* ä¸€èˆ¬å°æ¨™ç±¤ï¼ˆç´«ï¼Œè§€å¯Ÿç´€éŒ„ç”¨ï¼‰ */
      .tag-small {
        display: inline-block;
        padding: 3px 9px;
        border-radius: 10px;
        font-size: 12px;
        background: #eef2ff;
        color: #4f46e5;
        font-weight: 500;
      }

      /* ===== å­¸ç”Ÿå€‹åˆ¥é é¢ â€” åŸºæœ¬è³‡è¨Š ===== */
      .info-row {
        display: flex;
        align-items: flex-start;
        padding: 10px 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .info-row:last-child {
        border-bottom: none;
        padding-bottom: 0;
      }

      .info-row:first-child {
        padding-top: 0;
      }

      .info-label {
        width: 76px;
        font-size: 13px;
        color: #9ca3af;
        flex-shrink: 0;
        padding-top: 2px;
      }

      .info-value {
        font-size: 14px;
        color: #1f2937;
        font-weight: 500;
        flex: 1;
        line-height: 1.5;
      }

      /* å‚™è¨»æ¬„ä½ï¼ˆç°è‰²å¼•ç”¨æ„Ÿï¼‰ */
      .info-note {
        font-size: 13px;
        color: #6b7280;
        background: #f9fafb;
        border-left: 3px solid #d1d5db;
        padding: 6px 10px;
        border-radius: 4px;
        flex: 1;
        line-height: 1.6;
      }

      /* ===== Section æ¨™é¡Œ ===== */
      .section-title {
        font-size: 15px;
        font-weight: 700;
        color: #374151;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      /* ===== ç´€éŒ„æ™‚é–“è»¸ ===== */
      /* å·¦å´è±ç·šä¸²é€£çš„æ™‚é–“è»¸è¨­è¨ˆ */
      .record-timeline {
        position: relative;
        padding-left: 24px;
      }

      /* å·¦å´è±ç·š */
      .record-timeline::before {
        content: "";
        position: absolute;
        left: 7px;
        top: 6px;
        bottom: 6px;
        width: 2px;
        background: linear-gradient(to bottom, #c7d2fe, #e5e7eb);
        border-radius: 1px;
      }

      .record-item {
        position: relative;
        padding: 0 0 20px 16px;
      }

      .record-item:last-child {
        padding-bottom: 0;
      }

      /* æ™‚é–“ç¯€é»åœ“é» */
      .record-item::before {
        content: "";
        position: absolute;
        left: -19px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #6366f1;
        border: 2.5px solid #ffffff;
        box-shadow: 0 0 0 2px #c7d2fe;
        z-index: 1;
      }

      /* æœ€æ–°ä¸€ç­†ç´€éŒ„çš„ç¯€é»ç”¨ç«ç‘°ç²‰é«˜äº® */
      .record-item.latest::before {
        background: #ec4899;
        box-shadow: 0 0 0 2px #fce7f3;
      }

      .record-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
        margin-bottom: 5px;
      }

      .record-date-label {
        font-size: 12px;
        color: #9ca3af;
        font-weight: 500;
      }

      .record-note-text {
        font-size: 14px;
        color: #374151;
        line-height: 1.65;
      }

      /* æ–°å¢å¾Œçš„é«˜äº®å‹•ç•« */
      @keyframes newRecordHighlight {
        0% {
          background-color: #fce7f3;
        }
        100% {
          background-color: transparent;
        }
      }

      .record-item.new-highlight {
        border-radius: 8px;
        animation: newRecordHighlight 2s ease forwards;
      }

      /* ===== åº•éƒ¨å›ºå®šæŒ‰éˆ• ===== */
      .content-with-bottom-btn {
        padding-bottom: 88px;
      }

      .bottom-fixed-area {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 14px 16px 20px;
        background: linear-gradient(to top, #f8fafc 75%, transparent);
        pointer-events: none;
      }

      .bottom-fixed-inner {
        max-width: 800px;
        margin: 0 auto;
        pointer-events: all;
      }

      /* ===== æŒ‰éˆ•æ¨£å¼ ===== */
      /* ä¸»æŒ‰éˆ•ï¼ˆç´«ï¼‰ */
      .btn-primary {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        width: 100%;
        padding: 14px 24px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: #ffffff;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: "Noto Sans TC", sans-serif;
        box-shadow: 0 4px 14px rgba(99, 102, 241, 0.35);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
      }

      .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
      }

      /* Phase 2 é ç•™æŒ‰éˆ•ï¼ˆç°è‰²ä¸å¯é»æ“Šï¼‰ */
      .btn-phase2 {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 9px 16px;
        background: #f3f4f6;
        color: #9ca3af;
        border: 1.5px dashed #d1d5db;
        border-radius: 10px;
        font-size: 14px;
        cursor: not-allowed;
        position: relative;
        font-family: "Noto Sans TC", sans-serif;
        transition: all 0.2s ease;
        user-select: none;
      }

      /* Tooltipã€Œå³å°‡æ¨å‡ºã€ï¼Œhover é¡¯ç¤º */
      .btn-phase2::after {
        content: "ğŸ”œ å³å°‡æ¨å‡º";
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%);
        background: #1f2937;
        color: white;
        padding: 5px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 100;
        font-family: "Noto Sans TC", sans-serif;
      }

      /* Tooltip å°ç®­é ­ */
      .btn-phase2::before {
        content: "";
        position: absolute;
        bottom: calc(100% + 2px);
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #1f2937;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 100;
      }

      .btn-phase2:hover::after,
      .btn-phase2:hover::before {
        opacity: 1;
      }

      /* ===== è¡¨å–®æ¨£å¼ï¼ˆç‹€æ…‹ 3ï¼šæ–°å¢ç´€éŒ„ï¼‰ ===== */
      .form-section {
        margin-bottom: 12px;
      }

      .form-label {
        display: block;
        font-size: 14px;
        font-weight: 700;
        color: #374151;
        margin-bottom: 10px;
      }

      /* è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå¯å¤šé¸ï¼‰ */
      .tag-chips-area {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      /* æœªé¸ä¸­ç‹€æ…‹ */
      .tag-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 7px 14px;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        border: 2px solid #e5e7eb;
        background: #ffffff;
        color: #6b7280;
        transition: all 0.18s ease;
        user-select: none;
        font-family: "Noto Sans TC", sans-serif;
      }

      .tag-chip:hover {
        border-color: #a5b4fc;
        color: #6366f1;
        background: #f5f3ff;
      }

      /* é¸ä¸­ç‹€æ…‹ï¼ˆç´«è‰²å¡«å……ï¼‰ */
      .tag-chip.selected {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-color: #6366f1;
        color: #ffffff;
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        transform: scale(1.03);
      }

      /* æ–‡å­—è¼¸å…¥æ¡†ï¼ˆå¤§ã€å¥½è¼¸å…¥ï¼‰ */
      .record-textarea {
        width: 100%;
        padding: 14px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 15px;
        font-family: "Noto Sans TC", sans-serif;
        line-height: 1.7;
        outline: none;
        resize: vertical;
        min-height: 120px;
        transition: border-color 0.2s ease;
        color: #1f2937;
        background: #fefefe;
      }

      .record-textarea::placeholder {
        color: #9ca3af;
      }

      .record-textarea:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      /* Phase 2 æŒ‰éˆ•ç¾¤çµ„ */
      .phase2-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      /* ===== æˆåŠŸå‹•ç•«è¦†è“‹å±¤ ===== */
      #success-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.92);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      #success-overlay.show {
        opacity: 1;
        pointer-events: all;
      }

      @keyframes checkPop {
        0% {
          transform: scale(0) rotate(-10deg);
          opacity: 0;
        }
        60% {
          transform: scale(1.2) rotate(3deg);
          opacity: 1;
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      .success-icon {
        font-size: 72px;
        animation: checkPop 0.5s ease forwards;
      }

      .success-text {
        margin-top: 16px;
        font-size: 20px;
        font-weight: 700;
        color: #065f46;
        animation: checkPop 0.5s ease 0.1s both;
      }

      /* ===== ç©ºç‹€æ…‹æç¤º ===== */
      .empty-hint {
        text-align: center;
        color: #9ca3af;
        font-size: 14px;
        padding: 28px 0;
      }

      /* ===== Toast æç¤º ===== */
      .toast {
        position: fixed;
        bottom: 28px;
        left: 50%;
        transform: translateX(-50%);
        background: #1f2937;
        color: white;
        padding: 11px 22px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        white-space: nowrap;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.2);
        font-family: "Noto Sans TC", sans-serif;
      }

      .toast.show {
        opacity: 1;
      }

      /* ===== æ²è»¸ç¾åŒ– ===== */
      ::-webkit-scrollbar {
        width: 5px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }

      /* ===== éŸ¿æ‡‰å¼èª¿æ•´ ===== */
      @media (max-width: 480px) {
        .page-container {
          padding: 16px 12px;
        }

        .page-title {
          font-size: 18px;
        }

        .tag-chip {
          font-size: 13px;
          padding: 6px 12px;
        }
      }
    </style>
  </head>
  <body>
    <!-- ========================================
         ç‹€æ…‹ 1ï¼šå­¸ç”Ÿåˆ—è¡¨
         ======================================== -->
    <div id="view-list" class="view">
      <div class="page-container">
        <!-- é ‚éƒ¨æ¨™é¡Œåˆ— -->
        <div class="page-header">
          <a href="index.html" class="nav-back">â† é¦–é </a>
          <h1 class="page-title">å€‹æ¡ˆæœå‹™ç´€éŒ„</h1>
        </div>

        <!-- æœå°‹æ¡† -->
        <div class="search-wrapper">
          <input
            type="text"
            id="search-input"
            class="search-input"
            placeholder="ğŸ” æœå°‹å­¸ç”Ÿå§“å..."
            oninput="handleSearch(this.value)"
            autocomplete="off"
          />
        </div>

        <!-- å­¸ç”Ÿå¡ç‰‡åˆ—è¡¨ -->
        <div id="student-list" class="student-list"></div>

        <!-- ç„¡æœå°‹çµæœ -->
        <div id="no-results" class="empty-hint" style="display: none">
          æ‰¾ä¸åˆ°ç¬¦åˆã€Œ<span id="search-keyword"></span>ã€çš„å­¸ç”Ÿ
        </div>
      </div>
    </div>

    <!-- ========================================
         ç‹€æ…‹ 2ï¼šå­¸ç”Ÿå€‹åˆ¥é é¢
         ======================================== -->
    <div id="view-profile" class="view">
      <div class="page-container content-with-bottom-btn">
        <!-- é ‚éƒ¨å°è¦½ -->
        <div class="page-header">
          <span class="nav-back" onclick="showView('list')">â† è¿”å›åˆ—è¡¨</span>
          <h1 class="page-title" id="profile-name">å­¸ç”Ÿåå­—</h1>
        </div>

        <!-- åŸºæœ¬è³‡è¨Šå¡ç‰‡ -->
        <div class="card" style="margin-bottom: 14px">
          <!-- å§“å + é¢¨éšªç­‰ç´š -->
          <div class="info-row">
            <span class="info-label">å§“å</span>
            <div
              class="info-value"
              style="
                display: flex;
                align-items: center;
                gap: 8px;
                flex-wrap: wrap;
              "
            >
              <span id="profile-name-inline">â€”</span>
              <span id="profile-risk-tag" class="risk-tag">â€”</span>
            </div>
          </div>
          <!-- ç­ç´š -->
          <div class="info-row">
            <span class="info-label">ç­ç´š</span>
            <span class="info-value" id="profile-class">â€”</span>
          </div>
          <!-- è² è²¬ç¤¾å·¥ -->
          <div class="info-row">
            <span class="info-label">è² è²¬ç¤¾å·¥</span>
            <span class="info-value" id="profile-worker">â€”</span>
          </div>
          <!-- ç‰¹æ®Šå‚™è¨» -->
          <div class="info-row">
            <span class="info-label">ç‰¹æ®Šå‚™è¨»</span>
            <div id="profile-note" class="info-note">ç„¡</div>
          </div>
        </div>

        <!-- è¿‘æœŸç´€éŒ„æ™‚é–“è»¸ -->
        <div style="margin-bottom: 8px">
          <h2 class="section-title">ğŸ“‹ è¿‘æœŸæœå‹™ç´€éŒ„</h2>
          <div class="card" id="profile-records-card">
            <div id="profile-records"></div>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å›ºå®šã€Œæ–°å¢ç´€éŒ„ã€æŒ‰éˆ• -->
      <div class="bottom-fixed-area">
        <div class="bottom-fixed-inner">
          <button class="btn-primary" onclick="goToNewRecord()">
            ï¼‹ æ–°å¢ç´€éŒ„
          </button>
        </div>
      </div>
    </div>

    <!-- ========================================
         ç‹€æ…‹ 3ï¼šæ–°å¢è§€å¯Ÿç´€éŒ„
         ======================================== -->
    <div id="view-new-record" class="view">
      <div class="page-container content-with-bottom-btn">
        <!-- é ‚éƒ¨å°è¦½ -->
        <div class="page-header">
          <span class="nav-back" onclick="showView('profile')">â† è¿”å›</span>
          <h1 class="page-title">æ–°å¢è§€å¯Ÿç´€éŒ„</h1>
        </div>

        <!-- è¢«è¨˜éŒ„çš„å­¸ç”Ÿå -->
        <div
          style="
            margin-bottom: 14px;
            padding: 10px 14px;
            background: #eef2ff;
            border-radius: 10px;
            font-size: 14px;
            color: #4f46e5;
            font-weight: 600;
          "
        >
          ğŸ“ æ­£åœ¨ç‚º
          <span id="new-record-name" style="font-weight: 700"></span> æ–°å¢ç´€éŒ„
        </div>

        <!-- è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå¯å¤šé¸ï¼‰ -->
        <div class="form-section card">
          <label class="form-label">è§€å¯Ÿé¢å‘ï¼ˆå¯å¤šé¸ï¼‰</label>
          <div id="tag-chips-area" class="tag-chips-area"></div>
        </div>

        <!-- ç°¡çŸ­æè¿°æ–‡å­—æ¡† -->
        <div class="form-section card">
          <label class="form-label" for="record-note">è§€å¯Ÿæè¿°</label>
          <textarea
            id="record-note"
            class="record-textarea"
            placeholder="è«‹æè¿°ä½ è§€å¯Ÿåˆ°çš„æƒ…æ³..."
          ></textarea>
        </div>

        <!-- Phase 2 é ç•™åŠŸèƒ½ï¼ˆç°è‰²ä¸å¯é»æ“Šï¼‰ -->
        <div class="form-section card">
          <label
            class="form-label"
            style="color: #9ca3af; font-weight: 600; font-size: 13px"
          >
            Phase 2 åŠŸèƒ½é å‘Š
          </label>
          <div class="phase2-buttons">
            <button class="btn-phase2">ğŸ¤ èªéŸ³è¼¸å…¥</button>
            <button class="btn-phase2">ğŸ¤– AI è¼”åŠ©æ•´ç†</button>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å›ºå®šã€Œå„²å­˜ç´€éŒ„ã€æŒ‰éˆ• -->
      <div class="bottom-fixed-area">
        <div class="bottom-fixed-inner">
          <button class="btn-primary" onclick="saveRecord()">
            âœ… å„²å­˜ç´€éŒ„
          </button>
        </div>
      </div>
    </div>

    <!-- ========================================
         å„²å­˜æˆåŠŸå‹•ç•«è¦†è“‹å±¤
         ======================================== -->
    <div id="success-overlay">
      <div class="success-icon">âœ…</div>
      <div class="success-text">ç´€éŒ„å·²å„²å­˜ï¼</div>
    </div>

    <!-- Toast æç¤ºå…ƒä»¶ -->
    <div id="toast" class="toast"></div>

    <!-- ========================================
         JavaScriptï¼šè‡ªå¸¶å‡è³‡æ–™ + äº’å‹•é‚è¼¯
         ======================================== -->
    <script>
      /* ============================================================
         å‡è³‡æ–™å€ï¼šå­¸ç”Ÿè³‡æ–™ï¼ˆ8 ä½ï¼‰
         ============================================================ */
      const STUDENTS = [
        {
          id: "s1",
          name: "ç‹å°æ˜",
          className: "å…‰æ˜åœ‹å° Aç­",
          risk: "high", // é«˜é¢¨éšª
          riskLabel: "ğŸ”´ é«˜é¢¨éšª",
          worker: "æ—ä½³ç© ç¤¾å·¥å¸«",
          note: "å®¶åº­ç‹€æ³éœ€é—œæ³¨ï¼Œå–®è¦ªå®¶åº­ï¼Œåª½åª½å·¥ä½œç¹å¿™ï¼Œæ”¾å­¸å¾Œå¸¸ç„¡äººç…§æ–™ã€‚",
          lastRecord: "2026/02/20",
        },
        {
          id: "s2",
          name: "é™³ç¾éº—",
          className: "å…‰æ˜åœ‹å° Aç­",
          risk: "stable", // ç©©å®š
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "æ—ä½³ç© ç¤¾å·¥å¸«",
          note: "æƒ…ç·’ç®¡ç†é€²æ­¥ä¸­ï¼Œè¿‘æœŸåœ¨èª²å ‚ä¸Šçš„åƒèˆ‡åº¦æ˜é¡¯æå‡ã€‚",
          lastRecord: "2026/02/21",
        },
        {
          id: "s3",
          name: "æå¤§è¯",
          className: "å¸Œæœ›åœ‹å° Bç­",
          risk: "watch", // éœ€é—œæ³¨
          riskLabel: "ğŸŸ¡ éœ€é—œæ³¨",
          worker: "å¼µå¿—æ˜ ç¤¾å·¥å¸«",
          note: "å­¸ç¿’è½å¾Œï¼Œå»ºè­°å®‰æ’èª²å¾Œè¼”å°ï¼Œé–±è®€ç†è§£èƒ½åŠ›éœ€åŠ å¼·ã€‚",
          lastRecord: "2026/02/19",
        },
        {
          id: "s4",
          name: "å¼µå¿—è±ª",
          className: "å¸Œæœ›åœ‹å° Bç­",
          risk: "stable",
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "å¼µå¿—æ˜ ç¤¾å·¥å¸«",
          note: "äººéš›é—œä¿‚è‰¯å¥½ï¼Œæ˜¯ç­ä¸Šçš„å°é ˜è¢–ï¼Œå–œæ­¡ç…§é¡§åŒå­¸ã€‚",
          lastRecord: "2026/02/22",
        },
        {
          id: "s5",
          name: "æ—å°èŠ¬",
          className: "é™½å…‰åœ‹å° Cç­",
          risk: "watch",
          riskLabel: "ğŸŸ¡ éœ€é—œæ³¨",
          worker: "é™³é›…çª ç¤¾å·¥å¸«",
          note: "æƒ…ç·’èµ·ä¼è¼ƒå¤§ï¼Œæœ€è¿‘å®¶è£¡æœ‰è®Šæ•…ï¼Œéœ€å¯†åˆ‡é—œæ³¨æƒ…ç·’ç‹€æ…‹ã€‚",
          lastRecord: "2026/02/18",
        },
        {
          id: "s6",
          name: "é»ƒæ–‡å‚‘",
          className: "é™½å…‰åœ‹å° Cç­",
          risk: "stable",
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "é™³é›…çª ç¤¾å·¥å¸«",
          note: "è¡¨ç¾ç©©å®šï¼Œå­¸ç¿’æ…‹åº¦ç©æ¥µï¼Œæœ¬å­¸æœŸé€²æ­¥é¡¯è‘—ã€‚",
          lastRecord: "2026/02/21",
        },
        {
          id: "s7",
          name: "å³ä½³ç©",
          className: "å…‰æ˜åœ‹å° Aç­",
          risk: "stable",
          riskLabel: "ğŸŸ¢ ç©©å®š",
          worker: "æ—ä½³ç© ç¤¾å·¥å¸«",
          note: "å€‹æ€§é–‹æœ—ï¼Œèª²å ‚äº’å‹•æ´»èºï¼Œèƒ½ä¸»å‹•å¹«åŠ©åŒå­¸ã€‚",
          lastRecord: "2026/02/22",
        },
        {
          id: "s8",
          name: "å‘¨å­ç‘œ",
          className: "å¸Œæœ›åœ‹å° Bç­",
          risk: "high",
          riskLabel: "ğŸ”´ é«˜é¢¨éšª",
          worker: "å¼µå¿—æ˜ ç¤¾å·¥å¸«",
          note: "é•·æœŸç¼ºèª²ï¼Œå®¶åº­ç¶“æ¿Ÿå›°é›£ï¼Œå·²é€šå ±ç¤¾æœƒå±€å”åŠ©ï¼Œéœ€æŒçºŒè¿½è¹¤ã€‚",
          lastRecord: "2026/02/17",
        },
      ];

      /* ============================================================
         å‡è³‡æ–™å€ï¼šå€‹æ¡ˆç´€éŒ„ï¼ˆæ¯ä½å­¸ç”Ÿè‡³å°‘ 3 ç­†ï¼‰
         ============================================================ */
      const CASE_RECORDS = {
        s1: [
          {
            date: "2026-02-20",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹", "ğŸ  å®¶åº­ç‹€æ³"],
            note: "ä»Šå¤©æƒ…ç·’æ˜é¡¯ä½è½ï¼Œå¹¾ä¹ä¸åƒèˆ‡è¨è«–ï¼Œä¸‹èª²å¾Œç•™ä¸‹ä¾†èŠäº†ä¸€ä¸‹ï¼Œèªªåª½åª½æœ€è¿‘å¾ˆå°‘å›å®¶ï¼Œç¨è‡ªä¸€äººåœ¨å®¶æ„Ÿåˆ°å®³æ€•ã€‚",
          },
          {
            date: "2026-02-14",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "èˆ‡åŒå­¸ç™¼ç”Ÿå£è§’ï¼Œèªªå°æ–¹èªªäº†å¾ˆé›£è½çš„è©±ã€‚ç¶“èª¿è§£å¾Œå’Œå¥½ï¼Œä½†ä»æœ‰äº›æ‚¶æ‚¶ä¸æ¨‚ï¼Œéœ€è¦æŒçºŒè§€å¯Ÿã€‚",
          },
          {
            date: "2026-02-07",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡", "ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "ä¸Šèª²ç™¼è¨€æ¬¡æ•¸æ˜é¡¯å¢åŠ ï¼Œä¸»å‹•èˆ‰æ‰‹å›ç­”å•é¡Œå…©æ¬¡ã€‚è€å¸«åæ˜ æœ€è¿‘å­¸ç¿’æ…‹åº¦æœ‰æ”¹å–„ã€‚",
          },
        ],
        s2: [
          {
            date: "2026-02-21",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ä»Šå¤©éå¸¸ç©æ¥µï¼Œä¸»å‹•èˆ‰æ‰‹ç™¼è¨€ï¼Œå›ç­”å•é¡Œä¹Ÿéƒ½å¾ˆæº–ç¢ºï¼ŒåŒå­¸çµ¦äº†ç†±çƒˆæŒè²ã€‚",
          },
          {
            date: "2026-02-15",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "æ•´å¤©å¿ƒæƒ…ä¸éŒ¯ï¼Œä¸‹èª²æ™‚é–‹å¿ƒåœ°è·ŸåŒå­¸åˆ†äº«é€±æœ«å‡ºéŠçš„æ•…äº‹ï¼Œæƒ…ç·’ç©©å®šã€‚",
          },
          {
            date: "2026-02-08",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "ä¸»å‹•é‚€è«‹è½‰å­¸ç”Ÿä¸€èµ·åƒåˆé¤ï¼Œå±•ç¾å¾ˆå¥½çš„åŒç†å¿ƒï¼Œæ˜¯ç­ä¸Šçš„æ¨¡ç¯„ã€‚",
          },
        ],
        s3: [
          {
            date: "2026-02-19",
            tags: ["ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "åœ‹èªè€ƒè©¦é€²æ­¥äº† 12 åˆ†ï¼çµ¦äºˆå¤§åŠ›é¼“å‹µã€‚ä½†æ•¸å­¸ä»æœ‰å›°é›£ï¼Œå»ºè­°åŠ å¼·ã€‚",
          },
          {
            date: "2026-02-12",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡", "ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "èª²å ‚åƒèˆ‡æ„é¡˜ä¸é«˜ï¼Œè©¢å•å¾Œèªªä¸å¤ªè½å¾—æ‡‚è€å¸«åœ¨èªªä»€éº¼ï¼Œå»ºè­°å®‰æ’è£œæ•‘æ•™å­¸ã€‚",
          },
          {
            date: "2026-02-05",
            tags: ["ğŸ  å®¶åº­ç‹€æ³"],
            note: "èˆ‡å®¶é•·é›»è©±è¯ç¹«ï¼Œäº†è§£åˆ°ä½œæ¥­å¸¸æ²’äººå¯ä»¥è¼”å°ï¼Œå·²å»ºè­°å­¸æ ¡å®‰æ’èª²å¾Œè¼”å°è³‡æºã€‚",
          },
        ],
        s4: [
          {
            date: "2026-02-22",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "ä»Šå¤©æ“”ä»»å°çµ„é•·å¸¶é ˜è¨è«–ï¼Œè¡¨ç¾éå¸¸ç¨±è·ï¼Œè¢«è€å¸«ç•¶ä½œå…¨ç­æ¦œæ¨£ã€‚",
          },
          {
            date: "2026-02-15",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ä¸»å‹•å¹«åŠ©é‚„æ²’å¯«å®Œä½œæ¥­çš„åŒå­¸è£œåŠŸèª²ï¼Œå¸«é•·éƒ½è®šç¾ä»–æ˜¯ç­ä¸Šçš„å°è€å¸«ã€‚",
          },
          {
            date: "2026-02-08",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹", "ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "æ®µè€ƒæˆç¸¾è¡¨ç¾å„ªç•°ï¼Œå¿ƒæƒ…é–‹æœ—ï¼Œå°å­¸ç¿’å……æ»¿å‹•åŠ›ï¼Œç¹¼çºŒä¿æŒã€‚",
          },
        ],
        s5: [
          {
            date: "2026-02-18",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹", "ğŸ  å®¶åº­ç‹€æ³"],
            note: "ä¸Šèª²æ™‚çªç„¶å“­æ³£ï¼Œå¸¶åˆ°è¼”å°å®¤é™ªä¼´èŠäº† 30 åˆ†é˜ã€‚èªªçˆ¶æ¯æœ€è¿‘åµæ¶å¾ˆå…‡ï¼Œç¡ä¸å¥½è¦ºã€‚",
          },
          {
            date: "2026-02-11",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "åˆä¼‘æ™‚é–“ä¸€å€‹äººååœ¨è§’è½ï¼Œä¸é¡˜æ„åŠ å…¥åŒå­¸çš„éŠæˆ²ã€‚å˜—è©¦å¼•å°å¥¹åˆ†äº«æ„Ÿå—ï¼Œèªªæ€•è¢«æ’æ“ ã€‚",
          },
          {
            date: "2026-02-04",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "åƒèˆ‡åº¦æ¯”ä¸Šé€±å¥½å¾ˆå¤šï¼Œæœ‰ä¸»å‹•èˆ‰æ‰‹ä¸€æ¬¡ï¼Œçµ¦äºˆå£é ­é¼“å‹µï¼Œå¸Œæœ›æŒçºŒç¶­æŒã€‚",
          },
        ],
        s6: [
          {
            date: "2026-02-21",
            tags: ["ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "æ•¸å­¸æ®µè€ƒ 95 åˆ†ï¼Œæœ¬å­¸æœŸæœ€å¥½çš„æˆç¸¾ï¼é–‹å¿ƒåœ°è·Ÿç¤¾å·¥ç‚«è€€ï¼Œçµ¦ä»–å¤§åŠ›é¼“å‹µã€‚",
          },
          {
            date: "2026-02-14",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ç¾å‹èª²è¡¨ç¾éå¸¸çªå‡ºï¼Œä½œå“ç²é¸å±•ç¤ºï¼Œè€å¸«ç‰¹åˆ¥ç¨±è®šä»–çš„å‰µæ„ã€‚",
          },
          {
            date: "2026-02-07",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•", "ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "å’ŒåŒå­¸ç›¸è™•èæ´½ï¼Œèª²é–“ä¸€èµ·æ‰“ç±ƒçƒï¼Œå¿ƒæƒ…æ„‰å¿«ï¼Œæƒ…ç·’ç‹€æ…‹ç©©å®šã€‚",
          },
        ],
        s7: [
          {
            date: "2026-02-22",
            tags: ["ğŸ‘¥ äººéš›äº’å‹•"],
            note: "ä»Šå¤©ç©æ¥µçµ„ç¹”åŒå­¸ä¸€èµ·ç·´ç¿’è©±åŠ‡ï¼Œå±•ç¾è‰¯å¥½çš„é ˜å°åŠ›ï¼ŒåŒå­¸å€‘éƒ½å¾ˆé–‹å¿ƒã€‚",
          },
          {
            date: "2026-02-17",
            tags: ["ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "å¿ƒæƒ…éå¸¸å¥½ï¼Œè€ƒè©¦è€ƒå¾—ä¸éŒ¯ï¼Œè·Ÿç¤¾å·¥åˆ†äº«èªªæ˜¯ç¬¬ä¸€æ¬¡è€ƒé€™éº¼é«˜åˆ†ï¼Œç¬‘å¾—å¾ˆé–‹å¿ƒã€‚",
          },
          {
            date: "2026-02-10",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡", "ğŸ“– å­¸ç¿’è¡¨ç¾"],
            note: "èª²å ‚è¡¨ç¾ç©æ¥µï¼Œä¸»å‹•å›ç­”å•é¡Œï¼Œä½œæ¥­éƒ½æœ‰æŒ‰æ™‚å®Œæˆï¼Œå­¸ç¿’æ…‹åº¦å€¼å¾—è‚¯å®šã€‚",
          },
        ],
        s8: [
          {
            date: "2026-02-17",
            tags: ["ğŸ  å®¶åº­ç‹€æ³", "ğŸ’­ æƒ…ç·’ç‹€æ…‹"],
            note: "ä»Šå¤©ç¸½ç®—ä¾†äº†ï¼Œç²¾ç¥ä¸å¤ªå¥½ï¼Œèªªå®¶è£¡æœ€è¿‘ç™¼ç”Ÿäº†å¾ˆå¤šäº‹ï¼Œè©³ç´°äº†è§£å¾Œå·²é€šå ±ç¤¾æœƒå±€å”åŠ©ã€‚",
          },
          {
            date: "2026-02-10",
            tags: ["ğŸ“š èª²å ‚åƒèˆ‡"],
            note: "ç¼ºå¸­ä¸€é€±å¾Œå›åˆ°å­¸æ ¡ï¼Œèª²å ‚ä¸Šå¹¾ä¹æ²’æœ‰åƒèˆ‡ï¼Œéœ€è¦ç‰¹åˆ¥é—œæ³¨é‡æ–°èå…¥ç­ç´šçš„æƒ…æ³ã€‚",
          },
          {
            date: "2026-02-03",
            tags: ["ğŸ  å®¶åº­ç‹€æ³"],
            note: "å®¶è¨ªæ™‚äº†è§£åˆ°å®¶åº­ç¶“æ¿Ÿå›°é›£ï¼Œå·²å”åŠ©ç”³è«‹æ€¥é›£æ•‘åŠ©é‡‘ï¼Œå¾ŒçºŒè¿½è¹¤ç”³è«‹é€²åº¦ã€‚",
          },
        ],
      };

      /* ============================================================
         è§€å¯Ÿé¢å‘æ¨™ç±¤é¸é …
         ============================================================ */
      const OBSERVATION_TAGS = [
        "ğŸ“š èª²å ‚åƒèˆ‡",
        "ğŸ‘¥ äººéš›äº’å‹•",
        "ğŸ’­ æƒ…ç·’ç‹€æ…‹",
        "ğŸ“– å­¸ç¿’è¡¨ç¾",
        "ğŸ  å®¶åº­ç‹€æ³",
      ];

      /* ============================================================
         ç‹€æ…‹ç®¡ç†
         ============================================================ */
      // ç›®å‰é¸ä¸­çš„å­¸ç”Ÿ
      let currentStudent = null;

      /* ============================================================
         å·¥å…·å‡½å¼ï¼šé¡¯ç¤º Toast æç¤º
         ============================================================ */
      function showToast(msg, duration) {
        duration = duration || 2200;
        var toast = document.getElementById("toast");
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(function () {
          toast.classList.remove("show");
        }, duration);
      }

      /* ============================================================
         å·¥å…·å‡½å¼ï¼šæ—¥æœŸæ ¼å¼åŒ–
         2026-02-20 â†’ 2/20
         ============================================================ */
      function formatDate(dateStr) {
        // ç§»é™¤å¹´ä»½å’Œå‰ç½®é›¶
        return dateStr.replace(/^\d{4}-0?(\d+)-0?(\d+)$/, "$1/$2");
      }

      /* ============================================================
         ç•«é¢åˆ‡æ›ï¼šå¸¶å‹•ç•«æ•ˆæœ
         ============================================================ */
      function showView(viewName) {
        // éš±è—æ‰€æœ‰ view
        var views = document.querySelectorAll(".view");
        for (var i = 0; i < views.length; i++) {
          views[i].classList.remove("active");
        }

        // é¡¯ç¤ºç›®æ¨™ view
        var target = document.getElementById("view-" + viewName);
        if (target) {
          target.classList.add("active");
          // å¥—ç”¨é€²å ´å‹•ç•«
          target.classList.remove("slide-in");
          void target.offsetWidth; // å¼·åˆ¶ reflow è®“å‹•ç•«é‡æ–°è§¸ç™¼
          target.classList.add("slide-in");
          // å›åˆ°é ‚éƒ¨
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      /* ============================================================
         ç‹€æ…‹ 1ï¼šæ¸²æŸ“å­¸ç”Ÿåˆ—è¡¨
         æ”¯æ´å³æ™‚æœå°‹ç¯©é¸
         ============================================================ */
      function renderStudentList(filterText) {
        filterText = (filterText || "").trim();

        var listEl = document.getElementById("student-list");
        var noResultsEl = document.getElementById("no-results");
        var keywordEl = document.getElementById("search-keyword");

        // ç¯©é¸é‚è¼¯ï¼šæ¯”å°å­¸ç”Ÿå§“å
        var filtered = filterText
          ? STUDENTS.filter(function (s) {
              return s.name.indexOf(filterText) !== -1;
            })
          : STUDENTS;

        // ç„¡çµæœ
        if (filtered.length === 0) {
          listEl.innerHTML = "";
          noResultsEl.style.display = "block";
          keywordEl.textContent = filterText;
          return;
        }

        noResultsEl.style.display = "none";

        // æ¸²æŸ“å¡ç‰‡
        var html = "";
        for (var i = 0; i < filtered.length; i++) {
          var s = filtered[i];

          // è¨ˆç®—é¢¨éšªæ¨™ç±¤æ¨£å¼
          var riskClass =
            s.risk === "high"
              ? "risk-high"
              : s.risk === "watch"
                ? "risk-watch"
                : "risk-stable";

          // å–æœ€è¿‘ç´€éŒ„æ—¥æœŸ
          var records = CASE_RECORDS[s.id] || [];
          var latestDate = null;
          if (records.length > 0) {
            // ä¾æ—¥æœŸæ’åºå–æœ€æ–°
            var sorted = records.slice().sort(function (a, b) {
              return b.date.localeCompare(a.date);
            });
            latestDate = sorted[0].date;
          }
          var dateDisplay = latestDate
            ? "æœ€è¿‘ï¼š" + formatDate(latestDate)
            : "å°šç„¡ç´€éŒ„";

          // å¡ç‰‡ HTMLï¼ˆäº¤éŒ¯å‹•ç•«é  CSS å»¶é²ï¼‰
          html +=
            '<div class="card card-clickable" ' +
            'style="animation: staggerIn 0.4s ease ' +
            i * 0.07 +
            's both;" ' +
            "onclick=\"goToProfile('" +
            s.id +
            "')\">";

          html += '<div class="student-card-name">' + s.name + "</div>";
          html +=
            '<div class="student-card-class">ğŸ« ' + s.className + "</div>";

          html += '<div class="student-card-footer">';
          html +=
            '<span class="risk-tag ' +
            riskClass +
            '">' +
            s.riskLabel +
            "</span>";
          html +=
            '<span class="last-record-date' +
            (latestDate ? " has-record" : "") +
            '">' +
            dateDisplay +
            "</span>";
          html += "</div>";

          html += "</div>";
        }

        listEl.innerHTML = html;
      }

      /* ============================================================
         æœå°‹æ¡† oninput è™•ç†
         ============================================================ */
      function handleSearch(value) {
        renderStudentList(value);
      }

      /* ============================================================
         ç‹€æ…‹ 2ï¼šé€²å…¥å­¸ç”Ÿå€‹åˆ¥é é¢
         ============================================================ */
      function goToProfile(studentId) {
        // æ‰¾åˆ°å­¸ç”Ÿè³‡æ–™
        currentStudent = null;
        for (var i = 0; i < STUDENTS.length; i++) {
          if (STUDENTS[i].id === studentId) {
            currentStudent = STUDENTS[i];
            break;
          }
        }
        if (!currentStudent) return;

        // å¡«å…¥åŸºæœ¬è³‡è¨Š
        document.getElementById("profile-name").textContent =
          currentStudent.name;
        document.getElementById("profile-name-inline").textContent =
          currentStudent.name;
        document.getElementById("profile-class").textContent =
          currentStudent.className;
        document.getElementById("profile-worker").textContent =
          currentStudent.worker;

        // é¢¨éšªç­‰ç´šæ¨™ç±¤
        var riskTag = document.getElementById("profile-risk-tag");
        riskTag.textContent = currentStudent.riskLabel;
        riskTag.className =
          "risk-tag " +
          (currentStudent.risk === "high"
            ? "risk-high"
            : currentStudent.risk === "watch"
              ? "risk-watch"
              : "risk-stable");

        // ç‰¹æ®Šå‚™è¨»
        document.getElementById("profile-note").textContent =
          currentStudent.note || "ç„¡ç‰¹æ®Šå‚™è¨»";

        // æ¸²æŸ“ç´€éŒ„æ™‚é–“è»¸
        renderProfileRecords(studentId, false);

        // åˆ‡æ›åˆ°å€‹åˆ¥é é¢
        showView("profile");
      }

      /* ============================================================
         æ¸²æŸ“å­¸ç”Ÿçš„æœå‹™ç´€éŒ„æ™‚é–“è»¸
         highlightFirstï¼šæ˜¯å¦é«˜äº®æœ€æ–°ä¸€ç­†ï¼ˆæ–°å¢å¾Œä½¿ç”¨ï¼‰
         ============================================================ */
      function renderProfileRecords(studentId, highlightFirst) {
        var records = CASE_RECORDS[studentId] || [];
        var container = document.getElementById("profile-records");

        if (records.length === 0) {
          container.innerHTML =
            '<div class="empty-hint">ğŸ“­ å°šç„¡æœå‹™ç´€éŒ„<br><span style="font-size:12px;margin-top:6px;display:block;">é»æ“Šä¸‹æ–¹ã€Œæ–°å¢ç´€éŒ„ã€é–‹å§‹è¨˜éŒ„</span></div>';
          return;
        }

        // ä¾æ—¥æœŸé™åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨ä¸Šæ–¹ï¼‰
        var sorted = records.slice().sort(function (a, b) {
          return b.date.localeCompare(a.date);
        });

        var html = '<div class="record-timeline">';
        for (var i = 0; i < sorted.length; i++) {
          var r = sorted[i];
          var isLatest = i === 0;
          var highlightClass =
            highlightFirst && isLatest ? " new-highlight" : "";
          var latestClass = isLatest ? " latest" : "";

          html +=
            '<div class="record-item' + latestClass + highlightClass + '">';

          // æ—¥æœŸ + æ¨™ç±¤
          html += '<div class="record-meta">';
          html +=
            '<span class="record-date-label">ğŸ“… ' +
            formatDate(r.date) +
            "</span>";
          // è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå¯èƒ½å¤šå€‹ï¼‰
          var tags = r.tags || [];
          for (var t = 0; t < tags.length; t++) {
            html += '<span class="tag-small">' + tags[t] + "</span>";
          }
          html += "</div>";

          // æè¿°å…§å®¹
          html += '<p class="record-note-text">' + r.note + "</p>";

          html += "</div>";
        }
        html += "</div>";

        container.innerHTML = html;
      }

      /* ============================================================
         é€²å…¥ç‹€æ…‹ 3ï¼šæ–°å¢ç´€éŒ„
         ============================================================ */
      function goToNewRecord() {
        if (!currentStudent) return;

        // é¡¯ç¤ºè¢«è¨˜éŒ„çš„å­¸ç”Ÿå
        document.getElementById("new-record-name").textContent =
          currentStudent.name;

        // æ¸…ç©ºæ–‡å­—æ¡†
        document.getElementById("record-note").value = "";

        // æ¸²æŸ“è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼ˆå…¨éƒ¨åˆå§‹ç‚ºæœªé¸ä¸­ï¼‰
        var tagArea = document.getElementById("tag-chips-area");
        var tagHtml = "";
        for (var i = 0; i < OBSERVATION_TAGS.length; i++) {
          tagHtml +=
            '<span class="tag-chip" onclick="toggleTag(this)">' +
            OBSERVATION_TAGS[i] +
            "</span>";
        }
        tagArea.innerHTML = tagHtml;

        showView("new-record");
      }

      /* ============================================================
         è§€å¯Ÿé¢å‘æ¨™ç±¤ï¼šé»æ“Šåˆ‡æ›é¸å–ç‹€æ…‹
         ============================================================ */
      function toggleTag(el) {
        el.classList.toggle("selected");
      }

      /* ============================================================
         å„²å­˜æ–°ç´€éŒ„
         ============================================================ */
      function saveRecord() {
        // æ”¶é›†å·²é¸å–çš„æ¨™ç±¤
        var selectedEls = document.querySelectorAll(
          "#tag-chips-area .tag-chip.selected",
        );
        var selectedTags = [];
        for (var i = 0; i < selectedEls.length; i++) {
          selectedTags.push(selectedEls[i].textContent.trim());
        }

        // å–å¾—æè¿°å…§å®¹
        var note = document.getElementById("record-note").value.trim();

        // é©—è­‰ï¼šè‡³å°‘é¸ä¸€å€‹é¢å‘
        if (selectedTags.length === 0) {
          showToast("âš ï¸ è«‹è‡³å°‘é¸æ“‡ä¸€å€‹è§€å¯Ÿé¢å‘");
          return;
        }

        // é©—è­‰ï¼šæè¿°ä¸èƒ½ç©ºç™½
        if (!note) {
          showToast("âš ï¸ è«‹æè¿°ä½ è§€å¯Ÿåˆ°çš„æƒ…æ³");
          return;
        }

        // å–å¾—ä»Šå¤©æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
        var today = new Date().toISOString().split("T")[0];

        // å»ºç«‹æ–°ç´€éŒ„ç‰©ä»¶
        var newRecord = {
          date: today,
          tags: selectedTags,
          note: note,
        };

        // å­˜å…¥è¨˜æ†¶é«”ï¼ˆprepend åˆ°é™£åˆ—æœ€å‰é¢ï¼Œé¡¯ç¤ºåœ¨æ™‚é–“è»¸é ‚éƒ¨ï¼‰
        var sid = currentStudent.id;
        if (!CASE_RECORDS[sid]) {
          CASE_RECORDS[sid] = [];
        }
        CASE_RECORDS[sid].unshift(newRecord);

        // é¡¯ç¤ºæˆåŠŸå‹•ç•«
        showSuccessAnimation(function () {
          // å‹•ç•«çµæŸå¾Œè¿”å›å€‹åˆ¥é é¢ï¼Œä¸¦é«˜äº®æœ€æ–°ç´€éŒ„
          renderProfileRecords(sid, true);
          showView("profile");
        });
      }

      /* ============================================================
         æˆåŠŸå‹•ç•«ï¼šé¡¯ç¤ºæ‰“å‹¾ + ç¶ è‰²é–ƒç¾
         callbackï¼šå‹•ç•«çµæŸå¾ŒåŸ·è¡Œ
         ============================================================ */
      function showSuccessAnimation(callback) {
        var overlay = document.getElementById("success-overlay");
        overlay.classList.add("show");

        // 1.2 ç§’å¾Œéš±è—
        setTimeout(function () {
          overlay.classList.remove("show");
          if (callback) callback();
        }, 1200);
      }

      /* ============================================================
         é é¢åˆå§‹åŒ–
         ============================================================ */
      document.addEventListener("DOMContentLoaded", function () {
        // æ¸²æŸ“å­¸ç”Ÿåˆ—è¡¨ä¸¦é¡¯ç¤ºç‹€æ…‹ 1
        renderStudentList();
        showView("list");
      });
    </script>
  </body>
</html>
